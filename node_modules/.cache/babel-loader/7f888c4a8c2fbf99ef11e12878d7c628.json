{"ast":null,"code":"/**\n * Movement Controls\n *\n * @author Don McCurdy <dm@donmccurdy.com>\n */\nvar COMPONENT_SUFFIX = '-controls',\n    MAX_DELTA = 0.2,\n    // ms\nEPS = 10e-6;\nmodule.exports = AFRAME.registerComponent('movement-controls', {\n  /*******************************************************************\n   * Schema\n   */\n  dependencies: ['rotation'],\n  schema: {\n    enabled: {\n      default: true\n    },\n    controls: {\n      default: ['gamepad', 'trackpad', 'keyboard', 'touch']\n    },\n    speed: {\n      default: 0.3,\n      min: 0\n    },\n    fly: {\n      default: false\n    },\n    constrainToNavMesh: {\n      default: false\n    },\n    camera: {\n      default: '[movement-controls] [camera]',\n      type: 'selector'\n    }\n  },\n\n  /*******************************************************************\n   * Lifecycle\n   */\n  init: function init() {\n    var el = this.el;\n    this.velocityCtrl = null;\n    this.velocity = new THREE.Vector3();\n    this.heading = new THREE.Quaternion(); // Navigation\n\n    this.navGroup = null;\n    this.navNode = null;\n\n    if (el.sceneEl.hasLoaded) {\n      this.injectControls();\n    } else {\n      el.sceneEl.addEventListener('loaded', this.injectControls.bind(this));\n    }\n  },\n  update: function update(prevData) {\n    var el = this.el;\n    var data = this.data;\n    var nav = el.sceneEl.systems.nav;\n\n    if (el.sceneEl.hasLoaded) {\n      this.injectControls();\n    }\n\n    if (nav && data.constrainToNavMesh !== prevData.constrainToNavMesh) {\n      data.constrainToNavMesh ? nav.addAgent(this) : nav.removeAgent(this);\n    }\n  },\n  injectControls: function injectControls() {\n    var data = this.data;\n    var name;\n\n    for (var i = 0; i < data.controls.length; i++) {\n      name = data.controls[i] + COMPONENT_SUFFIX;\n\n      if (!this.el.components[name]) {\n        this.el.setAttribute(name, '');\n      }\n    }\n  },\n  updateNavLocation: function updateNavLocation() {\n    this.navGroup = null;\n    this.navNode = null;\n  },\n\n  /*******************************************************************\n   * Tick\n   */\n  tick: function () {\n    var start = new THREE.Vector3();\n    var end = new THREE.Vector3();\n    var clampedEnd = new THREE.Vector3();\n    return function (t, dt) {\n      if (!dt) return;\n      var el = this.el;\n      var data = this.data;\n      if (!data.enabled) return;\n      this.updateVelocityCtrl();\n      var velocityCtrl = this.velocityCtrl;\n      var velocity = this.velocity;\n      if (!velocityCtrl) return; // Update velocity. If FPS is too low, reset.\n\n      if (dt / 1000 > MAX_DELTA) {\n        velocity.set(0, 0, 0);\n      } else {\n        this.updateVelocity(dt);\n      }\n\n      if (data.constrainToNavMesh && velocityCtrl.isNavMeshConstrained !== false) {\n        if (velocity.lengthSq() < EPS) return;\n        start.copy(el.object3D.position);\n        end.copy(velocity).multiplyScalar(dt / 1000).add(start);\n        var nav = el.sceneEl.systems.nav;\n        this.navGroup = this.navGroup === null ? nav.getGroup(start) : this.navGroup;\n        this.navNode = this.navNode || nav.getNode(start, this.navGroup);\n        this.navNode = nav.clampStep(start, end, this.navGroup, this.navNode, clampedEnd);\n        el.object3D.position.copy(clampedEnd);\n      } else if (el.hasAttribute('velocity')) {\n        el.setAttribute('velocity', velocity);\n      } else {\n        el.object3D.position.x += velocity.x * dt / 1000;\n        el.object3D.position.y += velocity.y * dt / 1000;\n        el.object3D.position.z += velocity.z * dt / 1000;\n      }\n    };\n  }(),\n\n  /*******************************************************************\n   * Movement\n   */\n  updateVelocityCtrl: function updateVelocityCtrl() {\n    var data = this.data;\n\n    if (data.enabled) {\n      for (var i = 0, l = data.controls.length; i < l; i++) {\n        var control = this.el.components[data.controls[i] + COMPONENT_SUFFIX];\n\n        if (control && control.isVelocityActive()) {\n          this.velocityCtrl = control;\n          return;\n        }\n      }\n\n      this.velocityCtrl = null;\n    }\n  },\n  updateVelocity: function () {\n    var vector2 = new THREE.Vector2();\n    var quaternion = new THREE.Quaternion();\n    return function (dt) {\n      var dVelocity;\n      var el = this.el;\n      var control = this.velocityCtrl;\n      var velocity = this.velocity;\n      var data = this.data;\n\n      if (control) {\n        if (control.getVelocityDelta) {\n          dVelocity = control.getVelocityDelta(dt);\n        } else if (control.getVelocity) {\n          velocity.copy(control.getVelocity());\n          return;\n        } else if (control.getPositionDelta) {\n          velocity.copy(control.getPositionDelta(dt).multiplyScalar(1000 / dt));\n          return;\n        } else {\n          throw new Error('Incompatible movement controls: ', control);\n        }\n      }\n\n      if (el.hasAttribute('velocity') && !data.constrainToNavMesh) {\n        velocity.copy(this.el.getAttribute('velocity'));\n      }\n\n      if (dVelocity && data.enabled) {\n        var cameraEl = data.camera; // Rotate to heading\n\n        quaternion.copy(cameraEl.object3D.quaternion);\n        quaternion.premultiply(el.object3D.quaternion);\n        dVelocity.applyQuaternion(quaternion);\n        var factor = dVelocity.length();\n\n        if (data.fly) {\n          velocity.copy(dVelocity);\n          velocity.multiplyScalar(this.data.speed * 16.66667);\n        } else {\n          vector2.set(dVelocity.x, dVelocity.z);\n          vector2.setLength(factor * this.data.speed * 16.66667);\n          velocity.x = vector2.x;\n          velocity.z = vector2.y;\n        }\n      }\n    };\n  }()\n});","map":{"version":3,"names":["COMPONENT_SUFFIX","MAX_DELTA","EPS","module","exports","AFRAME","registerComponent","dependencies","schema","enabled","default","controls","speed","min","fly","constrainToNavMesh","camera","type","init","el","velocityCtrl","velocity","THREE","Vector3","heading","Quaternion","navGroup","navNode","sceneEl","hasLoaded","injectControls","addEventListener","bind","update","prevData","data","nav","systems","addAgent","removeAgent","name","i","length","components","setAttribute","updateNavLocation","tick","start","end","clampedEnd","t","dt","updateVelocityCtrl","set","updateVelocity","isNavMeshConstrained","lengthSq","copy","object3D","position","multiplyScalar","add","getGroup","getNode","clampStep","hasAttribute","x","y","z","l","control","isVelocityActive","vector2","Vector2","quaternion","dVelocity","getVelocityDelta","getVelocity","getPositionDelta","Error","getAttribute","cameraEl","premultiply","applyQuaternion","factor","setLength"],"sources":["X:/Project/graph/node_modules/aframe-extras/src/controls/movement-controls.js"],"sourcesContent":["/**\n * Movement Controls\n *\n * @author Don McCurdy <dm@donmccurdy.com>\n */\n\nconst COMPONENT_SUFFIX = '-controls',\n    MAX_DELTA = 0.2, // ms\n    EPS = 10e-6;\n\nmodule.exports = AFRAME.registerComponent('movement-controls', {\n\n  /*******************************************************************\n   * Schema\n   */\n\n  dependencies: ['rotation'],\n\n  schema: {\n    enabled:            { default: true },\n    controls:           { default: ['gamepad', 'trackpad', 'keyboard', 'touch'] },\n    speed:              { default: 0.3, min: 0 },\n    fly:                { default: false },\n    constrainToNavMesh: { default: false },\n    camera:             { default: '[movement-controls] [camera]', type: 'selector' }\n  },\n\n  /*******************************************************************\n   * Lifecycle\n   */\n\n  init: function () {\n    const el = this.el;\n\n    this.velocityCtrl = null;\n\n    this.velocity = new THREE.Vector3();\n    this.heading = new THREE.Quaternion();\n\n    // Navigation\n    this.navGroup = null;\n    this.navNode = null;\n\n    if (el.sceneEl.hasLoaded) {\n      this.injectControls();\n    } else {\n      el.sceneEl.addEventListener('loaded', this.injectControls.bind(this));\n    }\n  },\n\n  update: function (prevData) {\n    const el = this.el;\n    const data = this.data;\n    const nav = el.sceneEl.systems.nav;\n    if (el.sceneEl.hasLoaded) {\n      this.injectControls();\n    }\n    if (nav && data.constrainToNavMesh !== prevData.constrainToNavMesh) {\n      data.constrainToNavMesh\n        ? nav.addAgent(this)\n        : nav.removeAgent(this);\n    }\n  },\n\n  injectControls: function () {\n    const data = this.data;\n    var name;\n\n    for (let i = 0; i < data.controls.length; i++) {\n      name = data.controls[i] + COMPONENT_SUFFIX;\n      if (!this.el.components[name]) {\n        this.el.setAttribute(name, '');\n      }\n    }\n  },\n\n  updateNavLocation: function () {\n    this.navGroup = null;\n    this.navNode = null;\n  },\n\n  /*******************************************************************\n   * Tick\n   */\n\n  tick: (function () {\n    const start = new THREE.Vector3();\n    const end = new THREE.Vector3();\n    const clampedEnd = new THREE.Vector3();\n\n    return function (t, dt) {\n      if (!dt) return;\n\n      const el = this.el;\n      const data = this.data;\n\n      if (!data.enabled) return;\n\n      this.updateVelocityCtrl();\n      const velocityCtrl = this.velocityCtrl;\n      const velocity = this.velocity;\n\n      if (!velocityCtrl) return;\n\n      // Update velocity. If FPS is too low, reset.\n      if (dt / 1000 > MAX_DELTA) {\n        velocity.set(0, 0, 0);\n      } else {\n        this.updateVelocity(dt);\n      }\n\n      if (data.constrainToNavMesh\n          && velocityCtrl.isNavMeshConstrained !== false) {\n\n        if (velocity.lengthSq() < EPS) return;\n\n        start.copy(el.object3D.position);\n        end\n          .copy(velocity)\n          .multiplyScalar(dt / 1000)\n          .add(start);\n\n        const nav = el.sceneEl.systems.nav;\n        this.navGroup = this.navGroup === null ? nav.getGroup(start) : this.navGroup;\n        this.navNode = this.navNode || nav.getNode(start, this.navGroup);\n        this.navNode = nav.clampStep(start, end, this.navGroup, this.navNode, clampedEnd);\n        el.object3D.position.copy(clampedEnd);\n      } else if (el.hasAttribute('velocity')) {\n        el.setAttribute('velocity', velocity);\n      } else {\n        el.object3D.position.x += velocity.x * dt / 1000;\n        el.object3D.position.y += velocity.y * dt / 1000;\n        el.object3D.position.z += velocity.z * dt / 1000;\n      }\n\n    };\n  }()),\n\n  /*******************************************************************\n   * Movement\n   */\n\n  updateVelocityCtrl: function () {\n    const data = this.data;\n    if (data.enabled) {\n      for (let i = 0, l = data.controls.length; i < l; i++) {\n        const control = this.el.components[data.controls[i] + COMPONENT_SUFFIX];\n        if (control && control.isVelocityActive()) {\n          this.velocityCtrl = control;\n          return;\n        }\n      }\n      this.velocityCtrl = null;\n    }\n  },\n\n  updateVelocity: (function () {\n    const vector2 = new THREE.Vector2();\n    const quaternion = new THREE.Quaternion();\n\n    return function (dt) {\n      let dVelocity;\n      const el = this.el;\n      const control = this.velocityCtrl;\n      const velocity = this.velocity;\n      const data = this.data;\n\n      if (control) {\n        if (control.getVelocityDelta) {\n          dVelocity = control.getVelocityDelta(dt);\n        } else if (control.getVelocity) {\n          velocity.copy(control.getVelocity());\n          return;\n        } else if (control.getPositionDelta) {\n          velocity.copy(control.getPositionDelta(dt).multiplyScalar(1000 / dt));\n          return;\n        } else {\n          throw new Error('Incompatible movement controls: ', control);\n        }\n      }\n\n      if (el.hasAttribute('velocity') && !data.constrainToNavMesh) {\n        velocity.copy(this.el.getAttribute('velocity'));\n      }\n\n      if (dVelocity && data.enabled) {\n        const cameraEl = data.camera;\n\n        // Rotate to heading\n        quaternion.copy(cameraEl.object3D.quaternion);\n        quaternion.premultiply(el.object3D.quaternion);\n        dVelocity.applyQuaternion(quaternion);\n\n        const factor = dVelocity.length();\n        if (data.fly) {\n          velocity.copy(dVelocity);\n          velocity.multiplyScalar(this.data.speed * 16.66667);\n        } else {\n          vector2.set(dVelocity.x, dVelocity.z);\n          vector2.setLength(factor * this.data.speed * 16.66667);\n          velocity.x = vector2.x;\n          velocity.z = vector2.y;\n        }\n      }\n    };\n\n  }())\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}