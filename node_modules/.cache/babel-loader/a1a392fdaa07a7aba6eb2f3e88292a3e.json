{"ast":null,"code":"import { Group, Mesh, MeshLambertMaterial, Color, BufferGeometry, BufferAttribute, Matrix4, Vector3, SphereBufferGeometry, CylinderBufferGeometry, TubeBufferGeometry, ConeBufferGeometry, Line, LineBasicMaterial, QuadraticBezierCurve3, CubicBezierCurve3, Box3 } from 'three';\nimport { forceSimulation, forceLink, forceManyBody, forceCenter, forceRadial } from 'd3-force-3d';\nimport graph from 'ngraph.graph';\nimport forcelayout from 'ngraph.forcelayout';\nimport Kapsule from 'kapsule';\nimport accessorFn from 'accessor-fn';\nimport { min, max } from 'd3-array';\nimport dataJoint from 'data-joint';\nimport { scaleOrdinal } from 'd3-scale';\nimport { schemePaired } from 'd3-scale-chromatic';\nimport tinyColor from 'tinycolor2';\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar materialDispose = function materialDispose(material) {\n  if (material instanceof Array) {\n    material.forEach(materialDispose);\n  } else {\n    if (material.map) {\n      material.map.dispose();\n    }\n\n    material.dispose();\n  }\n};\n\nvar deallocate = function deallocate(obj) {\n  if (obj.geometry) {\n    obj.geometry.dispose();\n  }\n\n  if (obj.material) {\n    materialDispose(obj.material);\n  }\n\n  if (obj.texture) {\n    obj.texture.dispose();\n  }\n\n  if (obj.children) {\n    obj.children.forEach(deallocate);\n  }\n};\n\nvar emptyObject = function emptyObject(obj) {\n  while (obj.children.length) {\n    var childObj = obj.children[0];\n    obj.remove(childObj);\n    deallocate(childObj);\n  }\n};\n\nvar _excluded = [\"objFilter\"];\n\nfunction threeDigest(data, scene) {\n  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  var _ref$objFilter = _ref.objFilter,\n      objFilter = _ref$objFilter === void 0 ? function () {\n    return true;\n  } : _ref$objFilter,\n      options = _objectWithoutProperties(_ref, _excluded);\n\n  return dataJoint(data, scene.children.filter(objFilter), function (obj) {\n    return scene.add(obj);\n  }, function (obj) {\n    scene.remove(obj);\n    emptyObject(obj);\n  }, _objectSpread2({\n    objBindAttr: '__threeObj'\n  }, options));\n}\n\nvar colorStr2Hex = function colorStr2Hex(str) {\n  return isNaN(str) ? parseInt(tinyColor(str).toHex(), 16) : str;\n};\n\nvar colorAlpha = function colorAlpha(str) {\n  return isNaN(str) ? tinyColor(str).getAlpha() : 1;\n};\n\nvar autoColorScale = scaleOrdinal(schemePaired); // Autoset attribute colorField by colorByAccessor property\n// If an object has already a color, don't set it\n// Objects can be nodes or links\n\nfunction autoColorObjects(objects, colorByAccessor, colorField) {\n  if (!colorByAccessor || typeof colorField !== 'string') return;\n  objects.filter(function (obj) {\n    return !obj[colorField];\n  }).forEach(function (obj) {\n    obj[colorField] = autoColorScale(colorByAccessor(obj));\n  });\n}\n\nfunction getDagDepths(_ref, idAccessor) {\n  var nodes = _ref.nodes,\n      links = _ref.links;\n\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref2$nodeFilter = _ref2.nodeFilter,\n      nodeFilter = _ref2$nodeFilter === void 0 ? function () {\n    return true;\n  } : _ref2$nodeFilter,\n      _ref2$onLoopError = _ref2.onLoopError,\n      onLoopError = _ref2$onLoopError === void 0 ? function (loopIds) {\n    throw \"Invalid DAG structure! Found cycle in node path: \".concat(loopIds.join(' -> '), \".\");\n  } : _ref2$onLoopError; // linked graph\n\n\n  var graph = {};\n  nodes.forEach(function (node) {\n    return graph[idAccessor(node)] = {\n      data: node,\n      out: [],\n      depth: -1,\n      skip: !nodeFilter(node)\n    };\n  });\n  links.forEach(function (_ref3) {\n    var source = _ref3.source,\n        target = _ref3.target;\n    var sourceId = getNodeId(source);\n    var targetId = getNodeId(target);\n    if (!graph.hasOwnProperty(sourceId)) throw \"Missing source node with id: \".concat(sourceId);\n    if (!graph.hasOwnProperty(targetId)) throw \"Missing target node with id: \".concat(targetId);\n    var sourceNode = graph[sourceId];\n    var targetNode = graph[targetId];\n    sourceNode.out.push(targetNode);\n\n    function getNodeId(node) {\n      return _typeof(node) === 'object' ? idAccessor(node) : node;\n    }\n  });\n  var foundLoops = [];\n  traverse(Object.values(graph));\n  var nodeDepths = Object.assign.apply(Object, [{}].concat(_toConsumableArray(Object.entries(graph).filter(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n        node = _ref5[1];\n\n    return !node.skip;\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n        id = _ref7[0],\n        node = _ref7[1];\n\n    return _defineProperty({}, id, node.depth);\n  }))));\n  return nodeDepths;\n\n  function traverse(nodes) {\n    var nodeStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var currentDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      var node = nodes[i];\n\n      if (nodeStack.indexOf(node) !== -1) {\n        var _ret = function () {\n          var loop = [].concat(_toConsumableArray(nodeStack.slice(nodeStack.indexOf(node))), [node]).map(function (d) {\n            return idAccessor(d.data);\n          });\n\n          if (!foundLoops.some(function (foundLoop) {\n            return foundLoop.length === loop.length && foundLoop.every(function (id, idx) {\n              return id === loop[idx];\n            });\n          })) {\n            foundLoops.push(loop);\n            onLoopError(loop);\n          }\n\n          return \"continue\";\n        }();\n\n        if (_ret === \"continue\") continue;\n      }\n\n      if (currentDepth > node.depth) {\n        // Don't unnecessarily revisit chunks of the graph\n        node.depth = currentDepth;\n        traverse(node.out, [].concat(_toConsumableArray(nodeStack), [node]), currentDepth + (node.skip ? 0 : 1));\n      }\n    }\n  }\n}\n\nvar three$1 = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  Group: Group,\n  Mesh: Mesh,\n  MeshLambertMaterial: MeshLambertMaterial,\n  Color: Color,\n  BufferGeometry: BufferGeometry,\n  BufferAttribute: BufferAttribute,\n  Matrix4: Matrix4,\n  Vector3: Vector3,\n  SphereBufferGeometry: SphereBufferGeometry,\n  CylinderBufferGeometry: CylinderBufferGeometry,\n  TubeBufferGeometry: TubeBufferGeometry,\n  ConeBufferGeometry: ConeBufferGeometry,\n  Line: Line,\n  LineBasicMaterial: LineBasicMaterial,\n  QuadraticBezierCurve3: QuadraticBezierCurve3,\n  CubicBezierCurve3: CubicBezierCurve3,\n  Box3: Box3\n};\nvar ngraph = {\n  graph: graph,\n  forcelayout: forcelayout\n};\nvar DAG_LEVEL_NODE_RATIO = 2; // support multiple method names for backwards threejs compatibility\n\nvar setAttributeFn = new three$1.BufferGeometry().setAttribute ? 'setAttribute' : 'addAttribute';\nvar applyMatrix4Fn = new three$1.BufferGeometry().applyMatrix4 ? 'applyMatrix4' : 'applyMatrix';\nvar ForceGraph = Kapsule({\n  props: {\n    jsonUrl: {\n      onChange: function onChange(jsonUrl, state) {\n        var _this = this;\n\n        if (jsonUrl && !state.fetchingJson) {\n          // Load data asynchronously\n          state.fetchingJson = true;\n          state.onLoading();\n          fetch(jsonUrl).then(function (r) {\n            return r.json();\n          }).then(function (json) {\n            state.fetchingJson = false;\n            state.onFinishLoading(json);\n\n            _this.graphData(json);\n          });\n        }\n      },\n      triggerUpdate: false\n    },\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(graphData, state) {\n        state.engineRunning = false; // Pause simulation immediately\n      }\n    },\n    numDimensions: {\n      \"default\": 3,\n      onChange: function onChange(numDim, state) {\n        var chargeForce = state.d3ForceLayout.force('charge'); // Increase repulsion on 3D mode for improved spatial separation\n\n        if (chargeForce) {\n          chargeForce.strength(numDim > 2 ? -60 : -30);\n        }\n\n        if (numDim < 3) {\n          eraseDimension(state.graphData.nodes, 'z');\n        }\n\n        if (numDim < 2) {\n          eraseDimension(state.graphData.nodes, 'y');\n        }\n\n        function eraseDimension(nodes, dim) {\n          nodes.forEach(function (d) {\n            delete d[dim]; // position\n\n            delete d[\"v\".concat(dim)]; // velocity\n          });\n        }\n      }\n    },\n    dagMode: {\n      onChange: function onChange(dagMode, state) {\n        // td, bu, lr, rl, zin, zout, radialin, radialout\n        !dagMode && state.forceEngine === 'd3' && (state.graphData.nodes || []).forEach(function (n) {\n          return n.fx = n.fy = n.fz = undefined;\n        }); // unfix nodes when disabling dag mode\n      }\n    },\n    dagLevelDistance: {},\n    dagNodeFilter: {\n      \"default\": function _default(node) {\n        return true;\n      }\n    },\n    onDagError: {\n      triggerUpdate: false\n    },\n    nodeRelSize: {\n      \"default\": 4\n    },\n    // volume per val unit\n    nodeId: {\n      \"default\": 'id'\n    },\n    nodeVal: {\n      \"default\": 'val'\n    },\n    nodeResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the sphere's circumference\n    nodeColor: {\n      \"default\": 'color'\n    },\n    nodeAutoColorBy: {},\n    nodeOpacity: {\n      \"default\": 0.75\n    },\n    nodeVisibility: {\n      \"default\": true\n    },\n    nodeThreeObject: {},\n    nodeThreeObjectExtend: {\n      \"default\": false\n    },\n    linkSource: {\n      \"default\": 'source'\n    },\n    linkTarget: {\n      \"default\": 'target'\n    },\n    linkVisibility: {\n      \"default\": true\n    },\n    linkColor: {\n      \"default\": 'color'\n    },\n    linkAutoColorBy: {},\n    linkOpacity: {\n      \"default\": 0.2\n    },\n    linkWidth: {},\n    // Rounded to nearest decimal. For falsy values use dimensionless line with 1px regardless of distance.\n    linkResolution: {\n      \"default\": 6\n    },\n    // how many radial segments in each line tube's geometry\n    linkCurvature: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curvature radius (0: straight, 1: semi-circle)\n    linkCurveRotation: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curve rotation along the line axis (0: interection with XY plane, PI: upside down)\n    linkMaterial: {},\n    linkThreeObject: {},\n    linkThreeObjectExtend: {\n      \"default\": false\n    },\n    linkPositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the link's position. Signature: (threeObj, { start: { x, y, z},  end: { x, y, z }}, link). If the function returns a truthy value, the regular link position update will not run.\n    linkDirectionalArrowLength: {\n      \"default\": 0\n    },\n    linkDirectionalArrowColor: {},\n    linkDirectionalArrowRelPos: {\n      \"default\": 0.5,\n      triggerUpdate: false\n    },\n    // value between 0<>1 indicating the relative pos along the (exposed) line\n    linkDirectionalArrowResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the arrow's conic circumference\n    linkDirectionalParticles: {\n      \"default\": 0\n    },\n    // animate photons travelling in the link direction\n    linkDirectionalParticleSpeed: {\n      \"default\": 0.01,\n      triggerUpdate: false\n    },\n    // in link length ratio per frame\n    linkDirectionalParticleWidth: {\n      \"default\": 0.5\n    },\n    linkDirectionalParticleColor: {},\n    linkDirectionalParticleResolution: {\n      \"default\": 4\n    },\n    // how many slice segments in the particle sphere's circumference\n    forceEngine: {\n      \"default\": 'd3'\n    },\n    // d3 or ngraph\n    d3AlphaMin: {\n      \"default\": 0\n    },\n    d3AlphaDecay: {\n      \"default\": 0.0228,\n      triggerUpdate: false,\n      onChange: function onChange(alphaDecay, state) {\n        state.d3ForceLayout.alphaDecay(alphaDecay);\n      }\n    },\n    d3AlphaTarget: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: function onChange(alphaTarget, state) {\n        state.d3ForceLayout.alphaTarget(alphaTarget);\n      }\n    },\n    d3VelocityDecay: {\n      \"default\": 0.4,\n      triggerUpdate: false,\n      onChange: function onChange(velocityDecay, state) {\n        state.d3ForceLayout.velocityDecay(velocityDecay);\n      }\n    },\n    ngraphPhysics: {\n      \"default\": {\n        // defaults from https://github.com/anvaka/ngraph.physics.simulator/blob/master/index.js\n        timeStep: 20,\n        gravity: -1.2,\n        theta: 0.8,\n        springLength: 30,\n        springCoefficient: 0.0008,\n        dragCoefficient: 0.02\n      }\n    },\n    warmupTicks: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // how many times to tick the force engine at init before starting to render\n    cooldownTicks: {\n      \"default\": Infinity,\n      triggerUpdate: false\n    },\n    cooldownTime: {\n      \"default\": 15000,\n      triggerUpdate: false\n    },\n    // ms\n    onLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineTick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineStop: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    refresh: function refresh(state) {\n      state._flushObjects = true;\n\n      state._rerender();\n\n      return this;\n    },\n    // Expose d3 forces for external manipulation\n    d3Force: function d3Force(state, forceName, forceFn) {\n      if (forceFn === undefined) {\n        return state.d3ForceLayout.force(forceName); // Force getter\n      }\n\n      state.d3ForceLayout.force(forceName, forceFn); // Force setter\n\n      return this;\n    },\n    d3ReheatSimulation: function d3ReheatSimulation(state) {\n      state.d3ForceLayout.alpha(1);\n      this.resetCountdown();\n      return this;\n    },\n    // reset cooldown state\n    resetCountdown: function resetCountdown(state) {\n      state.cntTicks = 0;\n      state.startTickTime = new Date();\n      state.engineRunning = true;\n      return this;\n    },\n    tickFrame: function tickFrame(state) {\n      var isD3Sim = state.forceEngine !== 'ngraph';\n\n      if (state.engineRunning) {\n        layoutTick();\n      }\n\n      updateArrows();\n      updatePhotons();\n      return this; //\n\n      function layoutTick() {\n        if (++state.cntTicks > state.cooldownTicks || new Date() - state.startTickTime > state.cooldownTime || isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin) {\n          state.engineRunning = false; // Stop ticking graph\n\n          state.onEngineStop();\n        } else {\n          state.layout[isD3Sim ? 'tick' : 'step'](); // Tick it\n\n          state.onEngineTick();\n        } // Update nodes position\n\n\n        state.graphData.nodes.forEach(function (node) {\n          var obj = node.__threeObj;\n          if (!obj) return;\n          var pos = isD3Sim ? node : state.layout.getNodePosition(node[state.nodeId]);\n          obj.position.x = pos.x;\n          obj.position.y = pos.y || 0;\n          obj.position.z = pos.z || 0;\n        }); // Update links position\n\n        var linkWidthAccessor = accessorFn(state.linkWidth);\n        var linkCurvatureAccessor = accessorFn(state.linkCurvature);\n        var linkCurveRotationAccessor = accessorFn(state.linkCurveRotation);\n        var linkThreeObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n        state.graphData.links.forEach(function (link) {\n          var lineObj = link.__lineObj;\n          if (!lineObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          calcLinkCurve(link); // calculate link curve for all links, including custom replaced, so it can be used in directional functionality\n\n          var extendedObj = linkThreeObjectExtendAccessor(link);\n\n          if (state.linkPositionUpdate && state.linkPositionUpdate(extendedObj ? lineObj.children[1] : lineObj, // pass child custom object if extending the default\n          {\n            start: {\n              x: start.x,\n              y: start.y,\n              z: start.z\n            },\n            end: {\n              x: end.x,\n              y: end.y,\n              z: end.z\n            }\n          }, link) && !extendedObj) {\n            // exit if successfully custom updated position of non-extended obj\n            return;\n          }\n\n          var curveResolution = 30; // # line segments\n\n          var curve = link.__curve; // select default line obj if it's an extended group\n\n          var line = lineObj.children.length ? lineObj.children[0] : lineObj;\n\n          if (line.type === 'Line') {\n            // Update line geometry\n            if (!curve) {\n              // straight line\n              var linePos = line.geometry.getAttribute('position');\n\n              if (!linePos || !linePos.array || linePos.array.length !== 6) {\n                line.geometry[setAttributeFn]('position', linePos = new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              }\n\n              linePos.array[0] = start.x;\n              linePos.array[1] = start.y || 0;\n              linePos.array[2] = start.z || 0;\n              linePos.array[3] = end.x;\n              linePos.array[4] = end.y || 0;\n              linePos.array[5] = end.z || 0;\n              linePos.needsUpdate = true;\n            } else {\n              // bezier curve line\n              line.geometry.setFromPoints(curve.getPoints(curveResolution));\n            }\n\n            line.geometry.computeBoundingSphere();\n          } else if (line.type === 'Mesh') {\n            // Update cylinder geometry\n            if (!curve) {\n              // straight tube\n              if (!line.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)) {\n                var linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n                var r = linkWidth / 2;\n                var geometry = new three$1.CylinderBufferGeometry(r, r, 1, state.linkResolution, 1, false);\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                line.geometry.dispose();\n                line.geometry = geometry;\n              }\n\n              var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n              var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n              var distance = vStart.distanceTo(vEnd);\n              line.position.x = vStart.x;\n              line.position.y = vStart.y;\n              line.position.z = vStart.z;\n              line.scale.z = distance;\n              line.parent.localToWorld(vEnd); // lookAt requires world coords\n\n              line.lookAt(vEnd);\n            } else {\n              // curved tube\n              if (!line.geometry.type.match(/^Tube(Buffer)?Geometry$/)) {\n                // reset object positioning\n                line.position.set(0, 0, 0);\n                line.rotation.set(0, 0, 0);\n                line.scale.set(1, 1, 1);\n              }\n\n              var _linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n\n              var _r = _linkWidth / 2;\n\n              var _geometry = new three$1.TubeBufferGeometry(curve, curveResolution, _r, state.linkResolution, false);\n\n              line.geometry.dispose();\n              line.geometry = _geometry;\n            }\n          }\n        }); //\n\n        function calcLinkCurve(link) {\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var curvature = linkCurvatureAccessor(link);\n\n          if (!curvature) {\n            link.__curve = null; // Straight line\n          } else {\n            // bezier curve line (only for line types)\n            var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n            var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n            var l = vStart.distanceTo(vEnd); // line length\n\n            var curve;\n            var curveRotation = linkCurveRotationAccessor(link);\n\n            if (l > 0) {\n              var dx = end.x - start.x;\n              var dy = end.y - start.y || 0;\n              var vLine = new three$1.Vector3().subVectors(vEnd, vStart);\n              var cp = vLine.clone().multiplyScalar(curvature).cross(dx !== 0 || dy !== 0 ? new three$1.Vector3(0, 0, 1) : new three$1.Vector3(0, 1, 0)) // avoid cross-product of parallel vectors (prefer Z, fallback to Y)\n              .applyAxisAngle(vLine.normalize(), curveRotation) // rotate along line axis according to linkCurveRotation\n              .add(new three$1.Vector3().addVectors(vStart, vEnd).divideScalar(2));\n              curve = new three$1.QuadraticBezierCurve3(vStart, cp, vEnd);\n            } else {\n              // Same point, draw a loop\n              var d = curvature * 70;\n              var endAngle = -curveRotation; // Rotate clockwise (from Z angle perspective)\n\n              var startAngle = endAngle + Math.PI / 2;\n              curve = new three$1.CubicBezierCurve3(vStart, new three$1.Vector3(d * Math.cos(startAngle), d * Math.sin(startAngle), 0).add(vStart), new three$1.Vector3(d * Math.cos(endAngle), d * Math.sin(endAngle), 0).add(vStart), vEnd);\n            }\n\n            link.__curve = curve;\n          }\n        }\n      }\n\n      function updateArrows() {\n        // update link arrow position\n        var arrowRelPosAccessor = accessorFn(state.linkDirectionalArrowRelPos);\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var nodeValAccessor = accessorFn(state.nodeVal);\n        state.graphData.links.forEach(function (link) {\n          var arrowObj = link.__arrowObj;\n          if (!arrowObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var startR = Math.sqrt(Math.max(0, nodeValAccessor(start) || 1)) * state.nodeRelSize;\n          var endR = Math.sqrt(Math.max(0, nodeValAccessor(end) || 1)) * state.nodeRelSize;\n          var arrowLength = arrowLengthAccessor(link);\n          var arrowRelPos = arrowRelPosAccessor(link);\n          var getPosAlongLine = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var lineLen = link.__curve ? link.__curve.getLength() : Math.sqrt(['x', 'y', 'z'].map(function (dim) {\n            return Math.pow((end[dim] || 0) - (start[dim] || 0), 2);\n          }).reduce(function (acc, v) {\n            return acc + v;\n          }, 0));\n          var posAlongLine = startR + arrowLength + (lineLen - startR - endR - arrowLength) * arrowRelPos;\n          var arrowHead = getPosAlongLine(posAlongLine / lineLen);\n          var arrowTail = getPosAlongLine((posAlongLine - arrowLength) / lineLen);\n          ['x', 'y', 'z'].forEach(function (dim) {\n            return arrowObj.position[dim] = arrowTail[dim];\n          });\n\n          var headVec = _construct(three$1.Vector3, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n            return arrowHead[c];\n          })));\n\n          arrowObj.parent.localToWorld(headVec); // lookAt requires world coords\n\n          arrowObj.lookAt(headVec);\n        });\n      }\n\n      function updatePhotons() {\n        // update link particle positions\n        var particleSpeedAccessor = accessorFn(state.linkDirectionalParticleSpeed);\n        state.graphData.links.forEach(function (link) {\n          var cyclePhotons = link.__photonsObj && link.__photonsObj.children;\n          var singleHopPhotons = link.__singleHopPhotonsObj && link.__singleHopPhotonsObj.children;\n          if ((!singleHopPhotons || !singleHopPhotons.length) && (!cyclePhotons || !cyclePhotons.length)) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var particleSpeed = particleSpeedAccessor(link);\n          var getPhotonPos = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var photons = [].concat(_toConsumableArray(cyclePhotons || []), _toConsumableArray(singleHopPhotons || []));\n          photons.forEach(function (photon, idx) {\n            var singleHop = photon.parent.__linkThreeObjType === 'singleHopPhotons';\n\n            if (!photon.hasOwnProperty('__progressRatio')) {\n              photon.__progressRatio = singleHop ? 0 : idx / cyclePhotons.length;\n            }\n\n            photon.__progressRatio += particleSpeed;\n\n            if (photon.__progressRatio >= 1) {\n              if (!singleHop) {\n                photon.__progressRatio = photon.__progressRatio % 1;\n              } else {\n                // remove particle\n                photon.parent.remove(photon);\n                emptyObject(photon);\n                return;\n              }\n            }\n\n            var photonPosRatio = photon.__progressRatio;\n            var pos = getPhotonPos(photonPosRatio);\n            ['x', 'y', 'z'].forEach(function (dim) {\n              return photon.position[dim] = pos[dim];\n            });\n          });\n        });\n      }\n    },\n    emitParticle: function emitParticle(state, link) {\n      if (link) {\n        if (!link.__singleHopPhotonsObj) {\n          var obj = new three$1.Group();\n          obj.__linkThreeObjType = 'singleHopPhotons';\n          link.__singleHopPhotonsObj = obj;\n          state.graphScene.add(obj);\n        }\n\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n        var numSegments = state.linkDirectionalParticleResolution;\n        var particleGeometry = new three$1.SphereBufferGeometry(photonR, numSegments, numSegments);\n        var linkColorAccessor = accessorFn(state.linkColor);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var photonColor = particleColorAccessor(link) || linkColorAccessor(link) || '#f0f0f0';\n        var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n        var opacity = state.linkOpacity * 3;\n        var particleMaterial = new three$1.MeshLambertMaterial({\n          color: materialColor,\n          transparent: true,\n          opacity: opacity\n        }); // add a single hop particle\n\n        link.__singleHopPhotonsObj.add(new three$1.Mesh(particleGeometry, particleMaterial));\n      }\n\n      return this;\n    },\n    getGraphBbox: function getGraphBbox(state) {\n      var nodeFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      if (!state.initialised) return null; // recursively collect all nested geometries bboxes\n\n      var bboxes = function getBboxes(obj) {\n        var bboxes = [];\n\n        if (obj.geometry) {\n          obj.geometry.computeBoundingBox();\n          var box = new three$1.Box3();\n          box.copy(obj.geometry.boundingBox).applyMatrix4(obj.matrixWorld);\n          bboxes.push(box);\n        }\n\n        return bboxes.concat.apply(bboxes, _toConsumableArray((obj.children || []).filter(function (obj) {\n          return !obj.hasOwnProperty('__graphObjType') || obj.__graphObjType === 'node' && nodeFilter(obj.__data);\n        } // exclude filtered out nodes\n        ).map(getBboxes)));\n      }(state.graphScene);\n\n      if (!bboxes.length) return null; // extract global x,y,z min/max\n\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [min(bboxes, function (bb) {\n          return bb.min[c];\n        }), max(bboxes, function (bb) {\n          return bb.max[c];\n        })]);\n      })));\n    }\n  },\n  stateInit: function stateInit() {\n    return {\n      d3ForceLayout: forceSimulation().force('link', forceLink()).force('charge', forceManyBody()).force('center', forceCenter()).force('dagRadial', null).stop(),\n      engineRunning: false\n    };\n  },\n  init: function init(threeObj, state) {\n    // Main three object to manipulate\n    state.graphScene = threeObj;\n  },\n  update: function update(state, changedProps) {\n    var hasAnyPropChanged = function hasAnyPropChanged(propList) {\n      return propList.some(function (p) {\n        return changedProps.hasOwnProperty(p);\n      });\n    };\n\n    state.engineRunning = false; // pause simulation\n\n    state.onUpdate();\n\n    if (state.nodeAutoColorBy !== null && hasAnyPropChanged(['nodeAutoColorBy', 'graphData', 'nodeColor'])) {\n      // Auto add color to uncolored nodes\n      autoColorObjects(state.graphData.nodes, accessorFn(state.nodeAutoColorBy), state.nodeColor);\n    }\n\n    if (state.linkAutoColorBy !== null && hasAnyPropChanged(['linkAutoColorBy', 'graphData', 'linkColor'])) {\n      // Auto add color to uncolored links\n      autoColorObjects(state.graphData.links, accessorFn(state.linkAutoColorBy), state.linkColor);\n    } // Digest nodes WebGL objects\n\n\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'nodeThreeObject', 'nodeThreeObjectExtend', 'nodeVal', 'nodeColor', 'nodeVisibility', 'nodeRelSize', 'nodeResolution', 'nodeOpacity'])) {\n      var customObjectAccessor = accessorFn(state.nodeThreeObject);\n      var customObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n      var valAccessor = accessorFn(state.nodeVal);\n      var colorAccessor = accessorFn(state.nodeColor);\n      var visibilityAccessor = accessorFn(state.nodeVisibility);\n      var sphereGeometries = {}; // indexed by node value\n\n      var sphereMaterials = {}; // indexed by color\n\n      threeDigest(state.graphData.nodes.filter(visibilityAccessor), state.graphScene, {\n        purge: state._flushObjects || hasAnyPropChanged([// recreate objects if any of these props have changed\n        'nodeThreeObject', 'nodeThreeObjectExtend']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'node';\n        },\n        createObj: function createObj(node) {\n          var customObj = customObjectAccessor(node);\n          var extendObj = customObjectExtendAccessor(node);\n\n          if (customObj && state.nodeThreeObject === customObj) {\n            // clone object if it's a shared object among all nodes\n            customObj = customObj.clone();\n          }\n\n          var obj;\n\n          if (customObj && !extendObj) {\n            obj = customObj;\n          } else {\n            // Add default object (sphere mesh)\n            obj = new three$1.Mesh();\n            obj.__graphDefaultObj = true;\n\n            if (customObj && extendObj) {\n              obj.add(customObj); // extend default with custom\n            }\n          }\n\n          obj.__graphObjType = 'node'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(obj, node) {\n          if (obj.__graphDefaultObj) {\n            // bypass internal updates for custom node objects\n            var val = valAccessor(node) || 1;\n            var radius = Math.cbrt(val) * state.nodeRelSize;\n            var numSegments = state.nodeResolution;\n\n            if (!obj.geometry.type.match(/^Sphere(Buffer)?Geometry$/) || obj.geometry.parameters.radius !== radius || obj.geometry.parameters.widthSegments !== numSegments) {\n              if (!sphereGeometries.hasOwnProperty(val)) {\n                sphereGeometries[val] = new three$1.SphereBufferGeometry(radius, numSegments, numSegments);\n              }\n\n              obj.geometry.dispose();\n              obj.geometry = sphereGeometries[val];\n            }\n\n            var color = colorAccessor(node);\n            var materialColor = new three$1.Color(colorStr2Hex(color || '#ffffaa'));\n            var opacity = state.nodeOpacity * colorAlpha(color);\n\n            if (obj.material.type !== 'MeshLambertMaterial' || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n              if (!sphereMaterials.hasOwnProperty(color)) {\n                sphereMaterials[color] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n\n              obj.material.dispose();\n              obj.material = sphereMaterials[color];\n            }\n          }\n        }\n      });\n    } // Digest links WebGL objects\n\n\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'linkThreeObject', 'linkThreeObjectExtend', 'linkMaterial', 'linkColor', 'linkWidth', 'linkVisibility', 'linkResolution', 'linkOpacity', 'linkDirectionalArrowLength', 'linkDirectionalArrowColor', 'linkDirectionalArrowResolution', 'linkDirectionalParticles', 'linkDirectionalParticleWidth', 'linkDirectionalParticleColor', 'linkDirectionalParticleResolution'])) {\n      var _customObjectAccessor = accessorFn(state.linkThreeObject);\n\n      var _customObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n\n      var customMaterialAccessor = accessorFn(state.linkMaterial);\n\n      var _visibilityAccessor = accessorFn(state.linkVisibility);\n\n      var _colorAccessor = accessorFn(state.linkColor);\n\n      var widthAccessor = accessorFn(state.linkWidth);\n      var cylinderGeometries = {}; // indexed by link width\n\n      var lambertLineMaterials = {}; // for cylinder objects, indexed by link color\n\n      var basicLineMaterials = {}; // for line objects, indexed by link color\n\n      var visibleLinks = state.graphData.links.filter(_visibilityAccessor); // lines digest cycle\n\n      threeDigest(visibleLinks, state.graphScene, {\n        objBindAttr: '__lineObj',\n        purge: state._flushObjects || hasAnyPropChanged([// recreate objects if any of these props have changed\n        'linkThreeObject', 'linkThreeObjectExtend', 'linkWidth']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'link';\n        },\n        createObj: function createObj(link) {\n          var customObj = _customObjectAccessor(link);\n\n          var extendObj = _customObjectExtendAccessor(link);\n\n          if (customObj && state.linkThreeObject === customObj) {\n            // clone object if it's a shared object among all links\n            customObj = customObj.clone();\n          }\n\n          var defaultObj;\n\n          if (!customObj || extendObj) {\n            // construct default line obj\n            var useCylinder = !!widthAccessor(link);\n\n            if (useCylinder) {\n              defaultObj = new three$1.Mesh();\n            } else {\n              // Use plain line (constant width)\n              var lineGeometry = new three$1.BufferGeometry();\n              lineGeometry[setAttributeFn]('position', new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              defaultObj = new three$1.Line(lineGeometry);\n            }\n          }\n\n          var obj;\n\n          if (!customObj) {\n            obj = defaultObj;\n            obj.__graphDefaultObj = true;\n          } else {\n            if (!extendObj) {\n              // use custom object\n              obj = customObj;\n            } else {\n              // extend default with custom in a group\n              obj = new three$1.Group();\n              obj.__graphDefaultObj = true;\n              obj.add(defaultObj);\n              obj.add(customObj);\n            }\n          }\n\n          obj.renderOrder = 10; // Prevent visual glitches of dark lines on top of nodes by rendering them last\n\n          obj.__graphObjType = 'link'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(updObj, link) {\n          if (updObj.__graphDefaultObj) {\n            // bypass internal updates for custom link objects\n            // select default object if it's an extended group\n            var obj = updObj.children.length ? updObj.children[0] : updObj;\n            var linkWidth = Math.ceil(widthAccessor(link) * 10) / 10;\n            var useCylinder = !!linkWidth;\n\n            if (useCylinder) {\n              var r = linkWidth / 2;\n              var numSegments = state.linkResolution;\n\n              if (!obj.geometry.type.match(/^Cylinder(Buffer)?Geometry$/) || obj.geometry.parameters.radiusTop !== r || obj.geometry.parameters.radialSegments !== numSegments) {\n                if (!cylinderGeometries.hasOwnProperty(linkWidth)) {\n                  var geometry = new three$1.CylinderBufferGeometry(r, r, 1, numSegments, 1, false);\n                  geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                  geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                  cylinderGeometries[linkWidth] = geometry;\n                }\n\n                obj.geometry.dispose();\n                obj.geometry = cylinderGeometries[linkWidth];\n              }\n            }\n\n            var customMaterial = customMaterialAccessor(link);\n\n            if (customMaterial) {\n              obj.material = customMaterial;\n            } else {\n              var color = _colorAccessor(link);\n\n              var materialColor = new three$1.Color(colorStr2Hex(color || '#f0f0f0'));\n              var opacity = state.linkOpacity * colorAlpha(color);\n              var materialType = useCylinder ? 'MeshLambertMaterial' : 'LineBasicMaterial';\n\n              if (obj.material.type !== materialType || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n                var lineMaterials = useCylinder ? lambertLineMaterials : basicLineMaterials;\n\n                if (!lineMaterials.hasOwnProperty(color)) {\n                  lineMaterials[color] = new three$1[materialType]({\n                    color: materialColor,\n                    transparent: opacity < 1,\n                    opacity: opacity,\n                    depthWrite: opacity >= 1 // Prevent transparency issues\n\n                  });\n                }\n\n                obj.material.dispose();\n                obj.material = lineMaterials[color];\n              }\n            }\n          }\n        }\n      }); // Arrows digest cycle\n\n      if (state.linkDirectionalArrowLength || changedProps.hasOwnProperty('linkDirectionalArrowLength')) {\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var arrowColorAccessor = accessorFn(state.linkDirectionalArrowColor);\n        threeDigest(visibleLinks.filter(arrowLengthAccessor), state.graphScene, {\n          objBindAttr: '__arrowObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'arrow';\n          },\n          createObj: function createObj() {\n            var obj = new three$1.Mesh(undefined, new three$1.MeshLambertMaterial({\n              transparent: true\n            }));\n            obj.__linkThreeObjType = 'arrow'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var arrowLength = arrowLengthAccessor(link);\n            var numSegments = state.linkDirectionalArrowResolution;\n\n            if (!obj.geometry.type.match(/^Cone(Buffer)?Geometry$/) || obj.geometry.parameters.height !== arrowLength || obj.geometry.parameters.radialSegments !== numSegments) {\n              var coneGeometry = new three$1.ConeBufferGeometry(arrowLength * 0.25, arrowLength, numSegments); // Correct orientation\n\n              coneGeometry.translate(0, arrowLength / 2, 0);\n              coneGeometry.rotateX(Math.PI / 2);\n              obj.geometry.dispose();\n              obj.geometry = coneGeometry;\n            }\n\n            obj.material.color = new three$1.Color(arrowColorAccessor(link) || _colorAccessor(link) || '#f0f0f0');\n            obj.material.opacity = state.linkOpacity * 3;\n          }\n        });\n      } // Photon particles digest cycle\n\n\n      if (state.linkDirectionalParticles || changedProps.hasOwnProperty('linkDirectionalParticles')) {\n        var particlesAccessor = accessorFn(state.linkDirectionalParticles);\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var particleMaterials = {}; // indexed by link color\n\n        var particleGeometries = {}; // indexed by particle width\n\n        threeDigest(visibleLinks.filter(particlesAccessor), state.graphScene, {\n          objBindAttr: '__photonsObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'photons';\n          },\n          createObj: function createObj() {\n            var obj = new three$1.Group();\n            obj.__linkThreeObjType = 'photons'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var numPhotons = Math.round(Math.abs(particlesAccessor(link)));\n            var curPhoton = !!obj.children.length && obj.children[0];\n            var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n            var numSegments = state.linkDirectionalParticleResolution;\n            var particleGeometry;\n\n            if (curPhoton && curPhoton.geometry.parameters.radius === photonR && curPhoton.geometry.parameters.widthSegments === numSegments) {\n              particleGeometry = curPhoton.geometry;\n            } else {\n              if (!particleGeometries.hasOwnProperty(photonR)) {\n                particleGeometries[photonR] = new three$1.SphereBufferGeometry(photonR, numSegments, numSegments);\n              }\n\n              particleGeometry = particleGeometries[photonR];\n              curPhoton && curPhoton.geometry.dispose();\n            }\n\n            var photonColor = particleColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n            var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n            var opacity = state.linkOpacity * 3;\n            var particleMaterial;\n\n            if (curPhoton && curPhoton.material.color.equals(materialColor) && curPhoton.material.opacity === opacity) {\n              particleMaterial = curPhoton.material;\n            } else {\n              if (!particleMaterials.hasOwnProperty(photonColor)) {\n                particleMaterials[photonColor] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n\n              particleMaterial = particleMaterials[photonColor];\n              curPhoton && curPhoton.material.dispose();\n            } // digest cycle for each photon\n\n\n            threeDigest(_toConsumableArray(new Array(numPhotons)).map(function (_, idx) {\n              return {\n                idx: idx\n              };\n            }), obj, {\n              idAccessor: function idAccessor(d) {\n                return d.idx;\n              },\n              createObj: function createObj() {\n                return new three$1.Mesh(particleGeometry, particleMaterial);\n              },\n              updateObj: function updateObj(obj) {\n                obj.geometry = particleGeometry;\n                obj.material = particleMaterial;\n              }\n            });\n          }\n        });\n      }\n    }\n\n    state._flushObjects = false; // reset objects refresh flag\n    // simulation engine\n\n    if (hasAnyPropChanged(['graphData', 'nodeId', 'linkSource', 'linkTarget', 'numDimensions', 'forceEngine', 'dagMode', 'dagNodeFilter', 'dagLevelDistance'])) {\n      state.engineRunning = false; // Pause simulation\n      // parse links\n\n      state.graphData.links.forEach(function (link) {\n        link.source = link[state.linkSource];\n        link.target = link[state.linkTarget];\n      }); // Feed data to force-directed layout\n\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      var layout;\n\n      if (isD3Sim) {\n        // D3-force\n        (layout = state.d3ForceLayout).stop().alpha(1) // re-heat the simulation\n        .numDimensions(state.numDimensions).nodes(state.graphData.nodes); // add links (if link force is still active)\n\n        var linkForce = state.d3ForceLayout.force('link');\n\n        if (linkForce) {\n          linkForce.id(function (d) {\n            return d[state.nodeId];\n          }).links(state.graphData.links);\n        } // setup dag force constraints\n\n\n        var nodeDepths = state.dagMode && getDagDepths(state.graphData, function (node) {\n          return node[state.nodeId];\n        }, {\n          nodeFilter: state.dagNodeFilter,\n          onLoopError: state.onDagError || undefined\n        });\n        var maxDepth = Math.max.apply(Math, _toConsumableArray(Object.values(nodeDepths || [])));\n        var dagLevelDistance = state.dagLevelDistance || state.graphData.nodes.length / (maxDepth || 1) * DAG_LEVEL_NODE_RATIO * (['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? 0.7 : 1); // Fix nodes to x,y,z for dag mode\n\n        if (state.dagMode) {\n          var getFFn = function getFFn(fix, invert) {\n            return function (node) {\n              return !fix ? undefined : (nodeDepths[node[state.nodeId]] - maxDepth / 2) * dagLevelDistance * (invert ? -1 : 1);\n            };\n          };\n\n          var fxFn = getFFn(['lr', 'rl'].indexOf(state.dagMode) !== -1, state.dagMode === 'rl');\n          var fyFn = getFFn(['td', 'bu'].indexOf(state.dagMode) !== -1, state.dagMode === 'td');\n          var fzFn = getFFn(['zin', 'zout'].indexOf(state.dagMode) !== -1, state.dagMode === 'zout');\n          state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n            node.fx = fxFn(node);\n            node.fy = fyFn(node);\n            node.fz = fzFn(node);\n          });\n        } // Use radial force for radial dags\n\n\n        state.d3ForceLayout.force('dagRadial', ['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? forceRadial(function (node) {\n          var nodeDepth = nodeDepths[node[state.nodeId]] || -1;\n          return (state.dagMode === 'radialin' ? maxDepth - nodeDepth : nodeDepth) * dagLevelDistance;\n        }).strength(function (node) {\n          return state.dagNodeFilter(node) ? 1 : 0;\n        }) : null);\n      } else {\n        // ngraph\n        var _graph = ngraph.graph();\n\n        state.graphData.nodes.forEach(function (node) {\n          _graph.addNode(node[state.nodeId]);\n        });\n        state.graphData.links.forEach(function (link) {\n          _graph.addLink(link.source, link.target);\n        });\n        layout = ngraph.forcelayout(_graph, _objectSpread2({\n          dimensions: state.numDimensions\n        }, state.ngraphPhysics));\n        layout.graph = _graph; // Attach graph reference to layout\n      }\n\n      for (var i = 0; i < state.warmupTicks && !(isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin); i++) {\n        layout[isD3Sim ? \"tick\" : \"step\"]();\n      } // Initial ticks before starting to render\n\n\n      state.layout = layout;\n      this.resetCountdown();\n    }\n\n    state.engineRunning = true; // resume simulation\n\n    state.onFinishUpdate();\n  }\n});\n\nfunction fromKapsule(kapsule) {\n  var baseClass = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Object;\n  var initKapsuleWithSelf = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var FromKapsule = /*#__PURE__*/function (_baseClass) {\n    _inherits(FromKapsule, _baseClass);\n\n    var _super = _createSuper(FromKapsule);\n\n    function FromKapsule() {\n      var _this;\n\n      _classCallCheck(this, FromKapsule);\n\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      _this = _super.call.apply(_super, [this].concat(args));\n      _this.__kapsuleInstance = kapsule().apply(void 0, [].concat(_toConsumableArray(initKapsuleWithSelf ? [_assertThisInitialized(_this)] : []), args));\n      return _this;\n    }\n\n    return _createClass(FromKapsule);\n  }(baseClass); // attach kapsule props/methods to class prototype\n\n\n  Object.keys(kapsule()).forEach(function (m) {\n    return FromKapsule.prototype[m] = function () {\n      var _this$__kapsuleInstan;\n\n      var returnVal = (_this$__kapsuleInstan = this.__kapsuleInstance)[m].apply(_this$__kapsuleInstan, arguments);\n\n      return returnVal === this.__kapsuleInstance ? this // chain based on this class, not the kapsule obj\n      : returnVal;\n    };\n  });\n  return FromKapsule;\n}\n\nvar three = window.THREE ? window.THREE : {\n  Group: Group\n}; // Prefer consumption from global THREE, if exists\n\nvar threeForcegraph = fromKapsule(ForceGraph, three.Group, true);\nexport { threeForcegraph as default };","map":{"version":3,"names":["Group","Mesh","MeshLambertMaterial","Color","BufferGeometry","BufferAttribute","Matrix4","Vector3","SphereBufferGeometry","CylinderBufferGeometry","TubeBufferGeometry","ConeBufferGeometry","Line","LineBasicMaterial","QuadraticBezierCurve3","CubicBezierCurve3","Box3","forceSimulation","forceLink","forceManyBody","forceCenter","forceRadial","graph","forcelayout","Kapsule","accessorFn","min","max","dataJoint","scaleOrdinal","schemePaired","tinyColor","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread2","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_typeof","obj","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","configurable","writable","_createClass","protoProps","staticProps","value","_inherits","subClass","superClass","create","_setPrototypeOf","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","__proto__","p","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Boolean","valueOf","call","e","_construct","Parent","args","Class","a","Function","bind","_objectWithoutPropertiesLoose","excluded","sourceKeys","indexOf","_objectWithoutProperties","sourceSymbolKeys","propertyIsEnumerable","_assertThisInitialized","self","ReferenceError","_possibleConstructorReturn","_createSuper","Derived","hasNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Array","isArray","_arrayLikeToArray","iter","from","_i","_arr","_n","_d","_s","_e","next","done","err","minLen","n","toString","slice","name","test","len","arr2","materialDispose","material","map","dispose","deallocate","geometry","texture","children","emptyObject","childObj","remove","_excluded","threeDigest","data","scene","_ref","undefined","_ref$objFilter","objFilter","options","add","objBindAttr","colorStr2Hex","str","isNaN","parseInt","toHex","colorAlpha","getAlpha","autoColorScale","autoColorObjects","objects","colorByAccessor","colorField","getDagDepths","idAccessor","nodes","links","_ref2","_ref2$nodeFilter","nodeFilter","_ref2$onLoopError","onLoopError","loopIds","concat","join","node","out","depth","skip","_ref3","sourceId","getNodeId","targetId","hasOwnProperty","sourceNode","targetNode","foundLoops","traverse","values","nodeDepths","assign","entries","_ref4","_ref5","_ref6","_ref7","id","nodeStack","currentDepth","l","_ret","loop","d","some","foundLoop","every","idx","three$1","window","THREE","ngraph","DAG_LEVEL_NODE_RATIO","setAttributeFn","setAttribute","applyMatrix4Fn","applyMatrix4","ForceGraph","jsonUrl","onChange","state","_this","fetchingJson","onLoading","fetch","then","r","json","onFinishLoading","graphData","triggerUpdate","engineRunning","numDimensions","numDim","chargeForce","d3ForceLayout","force","strength","eraseDimension","dim","dagMode","forceEngine","fx","fy","fz","dagLevelDistance","dagNodeFilter","_default","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","d3AlphaMin","d3AlphaDecay","alphaDecay","d3AlphaTarget","alphaTarget","d3VelocityDecay","velocityDecay","ngraphPhysics","timeStep","gravity","theta","springLength","springCoefficient","dragCoefficient","warmupTicks","cooldownTicks","Infinity","cooldownTime","onUpdate","onFinishUpdate","onEngineTick","onEngineStop","methods","refresh","_flushObjects","_rerender","d3Force","forceName","forceFn","d3ReheatSimulation","alpha","resetCountdown","cntTicks","startTickTime","Date","tickFrame","isD3Sim","layoutTick","updateArrows","updatePhotons","layout","__threeObj","pos","getNodePosition","position","x","y","z","linkWidthAccessor","linkCurvatureAccessor","linkCurveRotationAccessor","linkThreeObjectExtendAccessor","link","lineObj","__lineObj","getLinkPosition","getLink","start","end","calcLinkCurve","extendedObj","curveResolution","curve","__curve","line","type","linePos","getAttribute","array","Float32Array","needsUpdate","setFromPoints","getPoints","computeBoundingSphere","match","Math","ceil","makeTranslation","makeRotationX","PI","vStart","vEnd","distance","distanceTo","scale","parent","localToWorld","lookAt","set","rotation","_linkWidth","_r","_geometry","curvature","curveRotation","dx","dy","vLine","subVectors","cp","clone","multiplyScalar","cross","applyAxisAngle","normalize","addVectors","divideScalar","endAngle","startAngle","cos","sin","arrowRelPosAccessor","arrowLengthAccessor","nodeValAccessor","arrowObj","__arrowObj","startR","sqrt","endR","arrowLength","arrowRelPos","getPosAlongLine","t","getPoint","iplt","lineLen","getLength","pow","reduce","acc","v","posAlongLine","arrowHead","arrowTail","headVec","c","particleSpeedAccessor","cyclePhotons","__photonsObj","singleHopPhotons","__singleHopPhotonsObj","particleSpeed","getPhotonPos","photons","photon","singleHop","__linkThreeObjType","__progressRatio","photonPosRatio","emitParticle","graphScene","particleWidthAccessor","photonR","numSegments","particleGeometry","linkColorAccessor","particleColorAccessor","photonColor","materialColor","opacity","particleMaterial","color","transparent","getGraphBbox","initialised","bboxes","getBboxes","computeBoundingBox","box","copy","boundingBox","matrixWorld","__graphObjType","__data","bb","stateInit","stop","init","threeObj","update","changedProps","hasAnyPropChanged","propList","customObjectAccessor","customObjectExtendAccessor","valAccessor","colorAccessor","visibilityAccessor","sphereGeometries","sphereMaterials","purge","createObj","customObj","extendObj","__graphDefaultObj","updateObj","val","radius","cbrt","parameters","widthSegments","equals","_customObjectAccessor","_customObjectExtendAccessor","customMaterialAccessor","_visibilityAccessor","_colorAccessor","widthAccessor","cylinderGeometries","lambertLineMaterials","basicLineMaterials","visibleLinks","defaultObj","useCylinder","lineGeometry","renderOrder","updObj","radiusTop","radialSegments","customMaterial","materialType","lineMaterials","depthWrite","arrowColorAccessor","height","coneGeometry","translate","rotateX","particlesAccessor","particleMaterials","particleGeometries","numPhotons","round","abs","curPhoton","_","linkForce","maxDepth","getFFn","fix","invert","fxFn","fyFn","fzFn","nodeDepth","_graph","addNode","addLink","dimensions","fromKapsule","kapsule","baseClass","initKapsuleWithSelf","FromKapsule","_baseClass","_super","_len","_key","__kapsuleInstance","m","_this$__kapsuleInstan","returnVal","three","threeForcegraph","default"],"sources":["X:/Project/graph/node_modules/three-forcegraph/dist/three-forcegraph.module.js"],"sourcesContent":["import { Group, Mesh, MeshLambertMaterial, Color, BufferGeometry, BufferAttribute, Matrix4, Vector3, SphereBufferGeometry, CylinderBufferGeometry, TubeBufferGeometry, ConeBufferGeometry, Line, LineBasicMaterial, QuadraticBezierCurve3, CubicBezierCurve3, Box3 } from 'three';\nimport { forceSimulation, forceLink, forceManyBody, forceCenter, forceRadial } from 'd3-force-3d';\nimport graph from 'ngraph.graph';\nimport forcelayout from 'ngraph.forcelayout';\nimport Kapsule from 'kapsule';\nimport accessorFn from 'accessor-fn';\nimport { min, max } from 'd3-array';\nimport dataJoint from 'data-joint';\nimport { scaleOrdinal } from 'd3-scale';\nimport { schemePaired } from 'd3-scale-chromatic';\nimport tinyColor from 'tinycolor2';\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar materialDispose = function materialDispose(material) {\n  if (material instanceof Array) {\n    material.forEach(materialDispose);\n  } else {\n    if (material.map) {\n      material.map.dispose();\n    }\n\n    material.dispose();\n  }\n};\n\nvar deallocate = function deallocate(obj) {\n  if (obj.geometry) {\n    obj.geometry.dispose();\n  }\n\n  if (obj.material) {\n    materialDispose(obj.material);\n  }\n\n  if (obj.texture) {\n    obj.texture.dispose();\n  }\n\n  if (obj.children) {\n    obj.children.forEach(deallocate);\n  }\n};\n\nvar emptyObject = function emptyObject(obj) {\n  while (obj.children.length) {\n    var childObj = obj.children[0];\n    obj.remove(childObj);\n    deallocate(childObj);\n  }\n};\n\nvar _excluded = [\"objFilter\"];\n\nfunction threeDigest(data, scene) {\n  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  var _ref$objFilter = _ref.objFilter,\n      objFilter = _ref$objFilter === void 0 ? function () {\n    return true;\n  } : _ref$objFilter,\n      options = _objectWithoutProperties(_ref, _excluded);\n\n  return dataJoint(data, scene.children.filter(objFilter), function (obj) {\n    return scene.add(obj);\n  }, function (obj) {\n    scene.remove(obj);\n    emptyObject(obj);\n  }, _objectSpread2({\n    objBindAttr: '__threeObj'\n  }, options));\n}\n\nvar colorStr2Hex = function colorStr2Hex(str) {\n  return isNaN(str) ? parseInt(tinyColor(str).toHex(), 16) : str;\n};\n\nvar colorAlpha = function colorAlpha(str) {\n  return isNaN(str) ? tinyColor(str).getAlpha() : 1;\n};\n\nvar autoColorScale = scaleOrdinal(schemePaired); // Autoset attribute colorField by colorByAccessor property\n// If an object has already a color, don't set it\n// Objects can be nodes or links\n\nfunction autoColorObjects(objects, colorByAccessor, colorField) {\n  if (!colorByAccessor || typeof colorField !== 'string') return;\n  objects.filter(function (obj) {\n    return !obj[colorField];\n  }).forEach(function (obj) {\n    obj[colorField] = autoColorScale(colorByAccessor(obj));\n  });\n}\n\nfunction getDagDepths (_ref, idAccessor) {\n  var nodes = _ref.nodes,\n      links = _ref.links;\n\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref2$nodeFilter = _ref2.nodeFilter,\n      nodeFilter = _ref2$nodeFilter === void 0 ? function () {\n    return true;\n  } : _ref2$nodeFilter,\n      _ref2$onLoopError = _ref2.onLoopError,\n      onLoopError = _ref2$onLoopError === void 0 ? function (loopIds) {\n    throw \"Invalid DAG structure! Found cycle in node path: \".concat(loopIds.join(' -> '), \".\");\n  } : _ref2$onLoopError;\n\n  // linked graph\n  var graph = {};\n  nodes.forEach(function (node) {\n    return graph[idAccessor(node)] = {\n      data: node,\n      out: [],\n      depth: -1,\n      skip: !nodeFilter(node)\n    };\n  });\n  links.forEach(function (_ref3) {\n    var source = _ref3.source,\n        target = _ref3.target;\n    var sourceId = getNodeId(source);\n    var targetId = getNodeId(target);\n    if (!graph.hasOwnProperty(sourceId)) throw \"Missing source node with id: \".concat(sourceId);\n    if (!graph.hasOwnProperty(targetId)) throw \"Missing target node with id: \".concat(targetId);\n    var sourceNode = graph[sourceId];\n    var targetNode = graph[targetId];\n    sourceNode.out.push(targetNode);\n\n    function getNodeId(node) {\n      return _typeof(node) === 'object' ? idAccessor(node) : node;\n    }\n  });\n  var foundLoops = [];\n  traverse(Object.values(graph));\n  var nodeDepths = Object.assign.apply(Object, [{}].concat(_toConsumableArray(Object.entries(graph).filter(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n        node = _ref5[1];\n\n    return !node.skip;\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n        id = _ref7[0],\n        node = _ref7[1];\n\n    return _defineProperty({}, id, node.depth);\n  }))));\n  return nodeDepths;\n\n  function traverse(nodes) {\n    var nodeStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var currentDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      var node = nodes[i];\n\n      if (nodeStack.indexOf(node) !== -1) {\n        var _ret = function () {\n          var loop = [].concat(_toConsumableArray(nodeStack.slice(nodeStack.indexOf(node))), [node]).map(function (d) {\n            return idAccessor(d.data);\n          });\n\n          if (!foundLoops.some(function (foundLoop) {\n            return foundLoop.length === loop.length && foundLoop.every(function (id, idx) {\n              return id === loop[idx];\n            });\n          })) {\n            foundLoops.push(loop);\n            onLoopError(loop);\n          }\n\n          return \"continue\";\n        }();\n\n        if (_ret === \"continue\") continue;\n      }\n\n      if (currentDepth > node.depth) {\n        // Don't unnecessarily revisit chunks of the graph\n        node.depth = currentDepth;\n        traverse(node.out, [].concat(_toConsumableArray(nodeStack), [node]), currentDepth + (node.skip ? 0 : 1));\n      }\n    }\n  }\n}\n\nvar three$1 = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  Group: Group,\n  Mesh: Mesh,\n  MeshLambertMaterial: MeshLambertMaterial,\n  Color: Color,\n  BufferGeometry: BufferGeometry,\n  BufferAttribute: BufferAttribute,\n  Matrix4: Matrix4,\n  Vector3: Vector3,\n  SphereBufferGeometry: SphereBufferGeometry,\n  CylinderBufferGeometry: CylinderBufferGeometry,\n  TubeBufferGeometry: TubeBufferGeometry,\n  ConeBufferGeometry: ConeBufferGeometry,\n  Line: Line,\n  LineBasicMaterial: LineBasicMaterial,\n  QuadraticBezierCurve3: QuadraticBezierCurve3,\n  CubicBezierCurve3: CubicBezierCurve3,\n  Box3: Box3\n};\nvar ngraph = {\n  graph: graph,\n  forcelayout: forcelayout\n};\n\nvar DAG_LEVEL_NODE_RATIO = 2; // support multiple method names for backwards threejs compatibility\n\nvar setAttributeFn = new three$1.BufferGeometry().setAttribute ? 'setAttribute' : 'addAttribute';\nvar applyMatrix4Fn = new three$1.BufferGeometry().applyMatrix4 ? 'applyMatrix4' : 'applyMatrix';\nvar ForceGraph = Kapsule({\n  props: {\n    jsonUrl: {\n      onChange: function onChange(jsonUrl, state) {\n        var _this = this;\n\n        if (jsonUrl && !state.fetchingJson) {\n          // Load data asynchronously\n          state.fetchingJson = true;\n          state.onLoading();\n          fetch(jsonUrl).then(function (r) {\n            return r.json();\n          }).then(function (json) {\n            state.fetchingJson = false;\n            state.onFinishLoading(json);\n\n            _this.graphData(json);\n          });\n        }\n      },\n      triggerUpdate: false\n    },\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(graphData, state) {\n        state.engineRunning = false; // Pause simulation immediately\n      }\n    },\n    numDimensions: {\n      \"default\": 3,\n      onChange: function onChange(numDim, state) {\n        var chargeForce = state.d3ForceLayout.force('charge'); // Increase repulsion on 3D mode for improved spatial separation\n\n        if (chargeForce) {\n          chargeForce.strength(numDim > 2 ? -60 : -30);\n        }\n\n        if (numDim < 3) {\n          eraseDimension(state.graphData.nodes, 'z');\n        }\n\n        if (numDim < 2) {\n          eraseDimension(state.graphData.nodes, 'y');\n        }\n\n        function eraseDimension(nodes, dim) {\n          nodes.forEach(function (d) {\n            delete d[dim]; // position\n\n            delete d[\"v\".concat(dim)]; // velocity\n          });\n        }\n      }\n    },\n    dagMode: {\n      onChange: function onChange(dagMode, state) {\n        // td, bu, lr, rl, zin, zout, radialin, radialout\n        !dagMode && state.forceEngine === 'd3' && (state.graphData.nodes || []).forEach(function (n) {\n          return n.fx = n.fy = n.fz = undefined;\n        }); // unfix nodes when disabling dag mode\n      }\n    },\n    dagLevelDistance: {},\n    dagNodeFilter: {\n      \"default\": function _default(node) {\n        return true;\n      }\n    },\n    onDagError: {\n      triggerUpdate: false\n    },\n    nodeRelSize: {\n      \"default\": 4\n    },\n    // volume per val unit\n    nodeId: {\n      \"default\": 'id'\n    },\n    nodeVal: {\n      \"default\": 'val'\n    },\n    nodeResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the sphere's circumference\n    nodeColor: {\n      \"default\": 'color'\n    },\n    nodeAutoColorBy: {},\n    nodeOpacity: {\n      \"default\": 0.75\n    },\n    nodeVisibility: {\n      \"default\": true\n    },\n    nodeThreeObject: {},\n    nodeThreeObjectExtend: {\n      \"default\": false\n    },\n    linkSource: {\n      \"default\": 'source'\n    },\n    linkTarget: {\n      \"default\": 'target'\n    },\n    linkVisibility: {\n      \"default\": true\n    },\n    linkColor: {\n      \"default\": 'color'\n    },\n    linkAutoColorBy: {},\n    linkOpacity: {\n      \"default\": 0.2\n    },\n    linkWidth: {},\n    // Rounded to nearest decimal. For falsy values use dimensionless line with 1px regardless of distance.\n    linkResolution: {\n      \"default\": 6\n    },\n    // how many radial segments in each line tube's geometry\n    linkCurvature: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curvature radius (0: straight, 1: semi-circle)\n    linkCurveRotation: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curve rotation along the line axis (0: interection with XY plane, PI: upside down)\n    linkMaterial: {},\n    linkThreeObject: {},\n    linkThreeObjectExtend: {\n      \"default\": false\n    },\n    linkPositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the link's position. Signature: (threeObj, { start: { x, y, z},  end: { x, y, z }}, link). If the function returns a truthy value, the regular link position update will not run.\n    linkDirectionalArrowLength: {\n      \"default\": 0\n    },\n    linkDirectionalArrowColor: {},\n    linkDirectionalArrowRelPos: {\n      \"default\": 0.5,\n      triggerUpdate: false\n    },\n    // value between 0<>1 indicating the relative pos along the (exposed) line\n    linkDirectionalArrowResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the arrow's conic circumference\n    linkDirectionalParticles: {\n      \"default\": 0\n    },\n    // animate photons travelling in the link direction\n    linkDirectionalParticleSpeed: {\n      \"default\": 0.01,\n      triggerUpdate: false\n    },\n    // in link length ratio per frame\n    linkDirectionalParticleWidth: {\n      \"default\": 0.5\n    },\n    linkDirectionalParticleColor: {},\n    linkDirectionalParticleResolution: {\n      \"default\": 4\n    },\n    // how many slice segments in the particle sphere's circumference\n    forceEngine: {\n      \"default\": 'd3'\n    },\n    // d3 or ngraph\n    d3AlphaMin: {\n      \"default\": 0\n    },\n    d3AlphaDecay: {\n      \"default\": 0.0228,\n      triggerUpdate: false,\n      onChange: function onChange(alphaDecay, state) {\n        state.d3ForceLayout.alphaDecay(alphaDecay);\n      }\n    },\n    d3AlphaTarget: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: function onChange(alphaTarget, state) {\n        state.d3ForceLayout.alphaTarget(alphaTarget);\n      }\n    },\n    d3VelocityDecay: {\n      \"default\": 0.4,\n      triggerUpdate: false,\n      onChange: function onChange(velocityDecay, state) {\n        state.d3ForceLayout.velocityDecay(velocityDecay);\n      }\n    },\n    ngraphPhysics: {\n      \"default\": {\n        // defaults from https://github.com/anvaka/ngraph.physics.simulator/blob/master/index.js\n        timeStep: 20,\n        gravity: -1.2,\n        theta: 0.8,\n        springLength: 30,\n        springCoefficient: 0.0008,\n        dragCoefficient: 0.02\n      }\n    },\n    warmupTicks: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // how many times to tick the force engine at init before starting to render\n    cooldownTicks: {\n      \"default\": Infinity,\n      triggerUpdate: false\n    },\n    cooldownTime: {\n      \"default\": 15000,\n      triggerUpdate: false\n    },\n    // ms\n    onLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineTick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineStop: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    refresh: function refresh(state) {\n      state._flushObjects = true;\n\n      state._rerender();\n\n      return this;\n    },\n    // Expose d3 forces for external manipulation\n    d3Force: function d3Force(state, forceName, forceFn) {\n      if (forceFn === undefined) {\n        return state.d3ForceLayout.force(forceName); // Force getter\n      }\n\n      state.d3ForceLayout.force(forceName, forceFn); // Force setter\n\n      return this;\n    },\n    d3ReheatSimulation: function d3ReheatSimulation(state) {\n      state.d3ForceLayout.alpha(1);\n      this.resetCountdown();\n      return this;\n    },\n    // reset cooldown state\n    resetCountdown: function resetCountdown(state) {\n      state.cntTicks = 0;\n      state.startTickTime = new Date();\n      state.engineRunning = true;\n      return this;\n    },\n    tickFrame: function tickFrame(state) {\n      var isD3Sim = state.forceEngine !== 'ngraph';\n\n      if (state.engineRunning) {\n        layoutTick();\n      }\n\n      updateArrows();\n      updatePhotons();\n      return this; //\n\n      function layoutTick() {\n        if (++state.cntTicks > state.cooldownTicks || new Date() - state.startTickTime > state.cooldownTime || isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin) {\n          state.engineRunning = false; // Stop ticking graph\n\n          state.onEngineStop();\n        } else {\n          state.layout[isD3Sim ? 'tick' : 'step'](); // Tick it\n\n          state.onEngineTick();\n        } // Update nodes position\n\n\n        state.graphData.nodes.forEach(function (node) {\n          var obj = node.__threeObj;\n          if (!obj) return;\n          var pos = isD3Sim ? node : state.layout.getNodePosition(node[state.nodeId]);\n          obj.position.x = pos.x;\n          obj.position.y = pos.y || 0;\n          obj.position.z = pos.z || 0;\n        }); // Update links position\n\n        var linkWidthAccessor = accessorFn(state.linkWidth);\n        var linkCurvatureAccessor = accessorFn(state.linkCurvature);\n        var linkCurveRotationAccessor = accessorFn(state.linkCurveRotation);\n        var linkThreeObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n        state.graphData.links.forEach(function (link) {\n          var lineObj = link.__lineObj;\n          if (!lineObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          calcLinkCurve(link); // calculate link curve for all links, including custom replaced, so it can be used in directional functionality\n\n          var extendedObj = linkThreeObjectExtendAccessor(link);\n\n          if (state.linkPositionUpdate && state.linkPositionUpdate(extendedObj ? lineObj.children[1] : lineObj, // pass child custom object if extending the default\n          {\n            start: {\n              x: start.x,\n              y: start.y,\n              z: start.z\n            },\n            end: {\n              x: end.x,\n              y: end.y,\n              z: end.z\n            }\n          }, link) && !extendedObj) {\n            // exit if successfully custom updated position of non-extended obj\n            return;\n          }\n\n          var curveResolution = 30; // # line segments\n\n          var curve = link.__curve; // select default line obj if it's an extended group\n\n          var line = lineObj.children.length ? lineObj.children[0] : lineObj;\n\n          if (line.type === 'Line') {\n            // Update line geometry\n            if (!curve) {\n              // straight line\n              var linePos = line.geometry.getAttribute('position');\n\n              if (!linePos || !linePos.array || linePos.array.length !== 6) {\n                line.geometry[setAttributeFn]('position', linePos = new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              }\n\n              linePos.array[0] = start.x;\n              linePos.array[1] = start.y || 0;\n              linePos.array[2] = start.z || 0;\n              linePos.array[3] = end.x;\n              linePos.array[4] = end.y || 0;\n              linePos.array[5] = end.z || 0;\n              linePos.needsUpdate = true;\n            } else {\n              // bezier curve line\n              line.geometry.setFromPoints(curve.getPoints(curveResolution));\n            }\n\n            line.geometry.computeBoundingSphere();\n          } else if (line.type === 'Mesh') {\n            // Update cylinder geometry\n            if (!curve) {\n              // straight tube\n              if (!line.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)) {\n                var linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n                var r = linkWidth / 2;\n                var geometry = new three$1.CylinderBufferGeometry(r, r, 1, state.linkResolution, 1, false);\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                line.geometry.dispose();\n                line.geometry = geometry;\n              }\n\n              var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n              var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n              var distance = vStart.distanceTo(vEnd);\n              line.position.x = vStart.x;\n              line.position.y = vStart.y;\n              line.position.z = vStart.z;\n              line.scale.z = distance;\n              line.parent.localToWorld(vEnd); // lookAt requires world coords\n\n              line.lookAt(vEnd);\n            } else {\n              // curved tube\n              if (!line.geometry.type.match(/^Tube(Buffer)?Geometry$/)) {\n                // reset object positioning\n                line.position.set(0, 0, 0);\n                line.rotation.set(0, 0, 0);\n                line.scale.set(1, 1, 1);\n              }\n\n              var _linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n\n              var _r = _linkWidth / 2;\n\n              var _geometry = new three$1.TubeBufferGeometry(curve, curveResolution, _r, state.linkResolution, false);\n\n              line.geometry.dispose();\n              line.geometry = _geometry;\n            }\n          }\n        }); //\n\n        function calcLinkCurve(link) {\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var curvature = linkCurvatureAccessor(link);\n\n          if (!curvature) {\n            link.__curve = null; // Straight line\n          } else {\n            // bezier curve line (only for line types)\n            var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n            var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n            var l = vStart.distanceTo(vEnd); // line length\n\n            var curve;\n            var curveRotation = linkCurveRotationAccessor(link);\n\n            if (l > 0) {\n              var dx = end.x - start.x;\n              var dy = end.y - start.y || 0;\n              var vLine = new three$1.Vector3().subVectors(vEnd, vStart);\n              var cp = vLine.clone().multiplyScalar(curvature).cross(dx !== 0 || dy !== 0 ? new three$1.Vector3(0, 0, 1) : new three$1.Vector3(0, 1, 0)) // avoid cross-product of parallel vectors (prefer Z, fallback to Y)\n              .applyAxisAngle(vLine.normalize(), curveRotation) // rotate along line axis according to linkCurveRotation\n              .add(new three$1.Vector3().addVectors(vStart, vEnd).divideScalar(2));\n              curve = new three$1.QuadraticBezierCurve3(vStart, cp, vEnd);\n            } else {\n              // Same point, draw a loop\n              var d = curvature * 70;\n              var endAngle = -curveRotation; // Rotate clockwise (from Z angle perspective)\n\n              var startAngle = endAngle + Math.PI / 2;\n              curve = new three$1.CubicBezierCurve3(vStart, new three$1.Vector3(d * Math.cos(startAngle), d * Math.sin(startAngle), 0).add(vStart), new three$1.Vector3(d * Math.cos(endAngle), d * Math.sin(endAngle), 0).add(vStart), vEnd);\n            }\n\n            link.__curve = curve;\n          }\n        }\n      }\n\n      function updateArrows() {\n        // update link arrow position\n        var arrowRelPosAccessor = accessorFn(state.linkDirectionalArrowRelPos);\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var nodeValAccessor = accessorFn(state.nodeVal);\n        state.graphData.links.forEach(function (link) {\n          var arrowObj = link.__arrowObj;\n          if (!arrowObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var startR = Math.sqrt(Math.max(0, nodeValAccessor(start) || 1)) * state.nodeRelSize;\n          var endR = Math.sqrt(Math.max(0, nodeValAccessor(end) || 1)) * state.nodeRelSize;\n          var arrowLength = arrowLengthAccessor(link);\n          var arrowRelPos = arrowRelPosAccessor(link);\n          var getPosAlongLine = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var lineLen = link.__curve ? link.__curve.getLength() : Math.sqrt(['x', 'y', 'z'].map(function (dim) {\n            return Math.pow((end[dim] || 0) - (start[dim] || 0), 2);\n          }).reduce(function (acc, v) {\n            return acc + v;\n          }, 0));\n          var posAlongLine = startR + arrowLength + (lineLen - startR - endR - arrowLength) * arrowRelPos;\n          var arrowHead = getPosAlongLine(posAlongLine / lineLen);\n          var arrowTail = getPosAlongLine((posAlongLine - arrowLength) / lineLen);\n          ['x', 'y', 'z'].forEach(function (dim) {\n            return arrowObj.position[dim] = arrowTail[dim];\n          });\n\n          var headVec = _construct(three$1.Vector3, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n            return arrowHead[c];\n          })));\n\n          arrowObj.parent.localToWorld(headVec); // lookAt requires world coords\n\n          arrowObj.lookAt(headVec);\n        });\n      }\n\n      function updatePhotons() {\n        // update link particle positions\n        var particleSpeedAccessor = accessorFn(state.linkDirectionalParticleSpeed);\n        state.graphData.links.forEach(function (link) {\n          var cyclePhotons = link.__photonsObj && link.__photonsObj.children;\n          var singleHopPhotons = link.__singleHopPhotonsObj && link.__singleHopPhotonsObj.children;\n          if ((!singleHopPhotons || !singleHopPhotons.length) && (!cyclePhotons || !cyclePhotons.length)) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var particleSpeed = particleSpeedAccessor(link);\n          var getPhotonPos = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var photons = [].concat(_toConsumableArray(cyclePhotons || []), _toConsumableArray(singleHopPhotons || []));\n          photons.forEach(function (photon, idx) {\n            var singleHop = photon.parent.__linkThreeObjType === 'singleHopPhotons';\n\n            if (!photon.hasOwnProperty('__progressRatio')) {\n              photon.__progressRatio = singleHop ? 0 : idx / cyclePhotons.length;\n            }\n\n            photon.__progressRatio += particleSpeed;\n\n            if (photon.__progressRatio >= 1) {\n              if (!singleHop) {\n                photon.__progressRatio = photon.__progressRatio % 1;\n              } else {\n                // remove particle\n                photon.parent.remove(photon);\n                emptyObject(photon);\n                return;\n              }\n            }\n\n            var photonPosRatio = photon.__progressRatio;\n            var pos = getPhotonPos(photonPosRatio);\n            ['x', 'y', 'z'].forEach(function (dim) {\n              return photon.position[dim] = pos[dim];\n            });\n          });\n        });\n      }\n    },\n    emitParticle: function emitParticle(state, link) {\n      if (link) {\n        if (!link.__singleHopPhotonsObj) {\n          var obj = new three$1.Group();\n          obj.__linkThreeObjType = 'singleHopPhotons';\n          link.__singleHopPhotonsObj = obj;\n          state.graphScene.add(obj);\n        }\n\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n        var numSegments = state.linkDirectionalParticleResolution;\n        var particleGeometry = new three$1.SphereBufferGeometry(photonR, numSegments, numSegments);\n        var linkColorAccessor = accessorFn(state.linkColor);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var photonColor = particleColorAccessor(link) || linkColorAccessor(link) || '#f0f0f0';\n        var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n        var opacity = state.linkOpacity * 3;\n        var particleMaterial = new three$1.MeshLambertMaterial({\n          color: materialColor,\n          transparent: true,\n          opacity: opacity\n        }); // add a single hop particle\n\n        link.__singleHopPhotonsObj.add(new three$1.Mesh(particleGeometry, particleMaterial));\n      }\n\n      return this;\n    },\n    getGraphBbox: function getGraphBbox(state) {\n      var nodeFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      if (!state.initialised) return null; // recursively collect all nested geometries bboxes\n\n      var bboxes = function getBboxes(obj) {\n        var bboxes = [];\n\n        if (obj.geometry) {\n          obj.geometry.computeBoundingBox();\n          var box = new three$1.Box3();\n          box.copy(obj.geometry.boundingBox).applyMatrix4(obj.matrixWorld);\n          bboxes.push(box);\n        }\n\n        return bboxes.concat.apply(bboxes, _toConsumableArray((obj.children || []).filter(function (obj) {\n          return !obj.hasOwnProperty('__graphObjType') || obj.__graphObjType === 'node' && nodeFilter(obj.__data);\n        } // exclude filtered out nodes\n        ).map(getBboxes)));\n      }(state.graphScene);\n\n      if (!bboxes.length) return null; // extract global x,y,z min/max\n\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [min(bboxes, function (bb) {\n          return bb.min[c];\n        }), max(bboxes, function (bb) {\n          return bb.max[c];\n        })]);\n      })));\n    }\n  },\n  stateInit: function stateInit() {\n    return {\n      d3ForceLayout: forceSimulation().force('link', forceLink()).force('charge', forceManyBody()).force('center', forceCenter()).force('dagRadial', null).stop(),\n      engineRunning: false\n    };\n  },\n  init: function init(threeObj, state) {\n    // Main three object to manipulate\n    state.graphScene = threeObj;\n  },\n  update: function update(state, changedProps) {\n    var hasAnyPropChanged = function hasAnyPropChanged(propList) {\n      return propList.some(function (p) {\n        return changedProps.hasOwnProperty(p);\n      });\n    };\n\n    state.engineRunning = false; // pause simulation\n\n    state.onUpdate();\n\n    if (state.nodeAutoColorBy !== null && hasAnyPropChanged(['nodeAutoColorBy', 'graphData', 'nodeColor'])) {\n      // Auto add color to uncolored nodes\n      autoColorObjects(state.graphData.nodes, accessorFn(state.nodeAutoColorBy), state.nodeColor);\n    }\n\n    if (state.linkAutoColorBy !== null && hasAnyPropChanged(['linkAutoColorBy', 'graphData', 'linkColor'])) {\n      // Auto add color to uncolored links\n      autoColorObjects(state.graphData.links, accessorFn(state.linkAutoColorBy), state.linkColor);\n    } // Digest nodes WebGL objects\n\n\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'nodeThreeObject', 'nodeThreeObjectExtend', 'nodeVal', 'nodeColor', 'nodeVisibility', 'nodeRelSize', 'nodeResolution', 'nodeOpacity'])) {\n      var customObjectAccessor = accessorFn(state.nodeThreeObject);\n      var customObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n      var valAccessor = accessorFn(state.nodeVal);\n      var colorAccessor = accessorFn(state.nodeColor);\n      var visibilityAccessor = accessorFn(state.nodeVisibility);\n      var sphereGeometries = {}; // indexed by node value\n\n      var sphereMaterials = {}; // indexed by color\n\n      threeDigest(state.graphData.nodes.filter(visibilityAccessor), state.graphScene, {\n        purge: state._flushObjects || hasAnyPropChanged([// recreate objects if any of these props have changed\n        'nodeThreeObject', 'nodeThreeObjectExtend']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'node';\n        },\n        createObj: function createObj(node) {\n          var customObj = customObjectAccessor(node);\n          var extendObj = customObjectExtendAccessor(node);\n\n          if (customObj && state.nodeThreeObject === customObj) {\n            // clone object if it's a shared object among all nodes\n            customObj = customObj.clone();\n          }\n\n          var obj;\n\n          if (customObj && !extendObj) {\n            obj = customObj;\n          } else {\n            // Add default object (sphere mesh)\n            obj = new three$1.Mesh();\n            obj.__graphDefaultObj = true;\n\n            if (customObj && extendObj) {\n              obj.add(customObj); // extend default with custom\n            }\n          }\n\n          obj.__graphObjType = 'node'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(obj, node) {\n          if (obj.__graphDefaultObj) {\n            // bypass internal updates for custom node objects\n            var val = valAccessor(node) || 1;\n            var radius = Math.cbrt(val) * state.nodeRelSize;\n            var numSegments = state.nodeResolution;\n\n            if (!obj.geometry.type.match(/^Sphere(Buffer)?Geometry$/) || obj.geometry.parameters.radius !== radius || obj.geometry.parameters.widthSegments !== numSegments) {\n              if (!sphereGeometries.hasOwnProperty(val)) {\n                sphereGeometries[val] = new three$1.SphereBufferGeometry(radius, numSegments, numSegments);\n              }\n\n              obj.geometry.dispose();\n              obj.geometry = sphereGeometries[val];\n            }\n\n            var color = colorAccessor(node);\n            var materialColor = new three$1.Color(colorStr2Hex(color || '#ffffaa'));\n            var opacity = state.nodeOpacity * colorAlpha(color);\n\n            if (obj.material.type !== 'MeshLambertMaterial' || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n              if (!sphereMaterials.hasOwnProperty(color)) {\n                sphereMaterials[color] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n\n              obj.material.dispose();\n              obj.material = sphereMaterials[color];\n            }\n          }\n        }\n      });\n    } // Digest links WebGL objects\n\n\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'linkThreeObject', 'linkThreeObjectExtend', 'linkMaterial', 'linkColor', 'linkWidth', 'linkVisibility', 'linkResolution', 'linkOpacity', 'linkDirectionalArrowLength', 'linkDirectionalArrowColor', 'linkDirectionalArrowResolution', 'linkDirectionalParticles', 'linkDirectionalParticleWidth', 'linkDirectionalParticleColor', 'linkDirectionalParticleResolution'])) {\n      var _customObjectAccessor = accessorFn(state.linkThreeObject);\n\n      var _customObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n\n      var customMaterialAccessor = accessorFn(state.linkMaterial);\n\n      var _visibilityAccessor = accessorFn(state.linkVisibility);\n\n      var _colorAccessor = accessorFn(state.linkColor);\n\n      var widthAccessor = accessorFn(state.linkWidth);\n      var cylinderGeometries = {}; // indexed by link width\n\n      var lambertLineMaterials = {}; // for cylinder objects, indexed by link color\n\n      var basicLineMaterials = {}; // for line objects, indexed by link color\n\n      var visibleLinks = state.graphData.links.filter(_visibilityAccessor); // lines digest cycle\n\n      threeDigest(visibleLinks, state.graphScene, {\n        objBindAttr: '__lineObj',\n        purge: state._flushObjects || hasAnyPropChanged([// recreate objects if any of these props have changed\n        'linkThreeObject', 'linkThreeObjectExtend', 'linkWidth']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'link';\n        },\n        createObj: function createObj(link) {\n          var customObj = _customObjectAccessor(link);\n\n          var extendObj = _customObjectExtendAccessor(link);\n\n          if (customObj && state.linkThreeObject === customObj) {\n            // clone object if it's a shared object among all links\n            customObj = customObj.clone();\n          }\n\n          var defaultObj;\n\n          if (!customObj || extendObj) {\n            // construct default line obj\n            var useCylinder = !!widthAccessor(link);\n\n            if (useCylinder) {\n              defaultObj = new three$1.Mesh();\n            } else {\n              // Use plain line (constant width)\n              var lineGeometry = new three$1.BufferGeometry();\n              lineGeometry[setAttributeFn]('position', new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              defaultObj = new three$1.Line(lineGeometry);\n            }\n          }\n\n          var obj;\n\n          if (!customObj) {\n            obj = defaultObj;\n            obj.__graphDefaultObj = true;\n          } else {\n            if (!extendObj) {\n              // use custom object\n              obj = customObj;\n            } else {\n              // extend default with custom in a group\n              obj = new three$1.Group();\n              obj.__graphDefaultObj = true;\n              obj.add(defaultObj);\n              obj.add(customObj);\n            }\n          }\n\n          obj.renderOrder = 10; // Prevent visual glitches of dark lines on top of nodes by rendering them last\n\n          obj.__graphObjType = 'link'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(updObj, link) {\n          if (updObj.__graphDefaultObj) {\n            // bypass internal updates for custom link objects\n            // select default object if it's an extended group\n            var obj = updObj.children.length ? updObj.children[0] : updObj;\n            var linkWidth = Math.ceil(widthAccessor(link) * 10) / 10;\n            var useCylinder = !!linkWidth;\n\n            if (useCylinder) {\n              var r = linkWidth / 2;\n              var numSegments = state.linkResolution;\n\n              if (!obj.geometry.type.match(/^Cylinder(Buffer)?Geometry$/) || obj.geometry.parameters.radiusTop !== r || obj.geometry.parameters.radialSegments !== numSegments) {\n                if (!cylinderGeometries.hasOwnProperty(linkWidth)) {\n                  var geometry = new three$1.CylinderBufferGeometry(r, r, 1, numSegments, 1, false);\n                  geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                  geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                  cylinderGeometries[linkWidth] = geometry;\n                }\n\n                obj.geometry.dispose();\n                obj.geometry = cylinderGeometries[linkWidth];\n              }\n            }\n\n            var customMaterial = customMaterialAccessor(link);\n\n            if (customMaterial) {\n              obj.material = customMaterial;\n            } else {\n              var color = _colorAccessor(link);\n\n              var materialColor = new three$1.Color(colorStr2Hex(color || '#f0f0f0'));\n              var opacity = state.linkOpacity * colorAlpha(color);\n              var materialType = useCylinder ? 'MeshLambertMaterial' : 'LineBasicMaterial';\n\n              if (obj.material.type !== materialType || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n                var lineMaterials = useCylinder ? lambertLineMaterials : basicLineMaterials;\n\n                if (!lineMaterials.hasOwnProperty(color)) {\n                  lineMaterials[color] = new three$1[materialType]({\n                    color: materialColor,\n                    transparent: opacity < 1,\n                    opacity: opacity,\n                    depthWrite: opacity >= 1 // Prevent transparency issues\n\n                  });\n                }\n\n                obj.material.dispose();\n                obj.material = lineMaterials[color];\n              }\n            }\n          }\n        }\n      }); // Arrows digest cycle\n\n      if (state.linkDirectionalArrowLength || changedProps.hasOwnProperty('linkDirectionalArrowLength')) {\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var arrowColorAccessor = accessorFn(state.linkDirectionalArrowColor);\n        threeDigest(visibleLinks.filter(arrowLengthAccessor), state.graphScene, {\n          objBindAttr: '__arrowObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'arrow';\n          },\n          createObj: function createObj() {\n            var obj = new three$1.Mesh(undefined, new three$1.MeshLambertMaterial({\n              transparent: true\n            }));\n            obj.__linkThreeObjType = 'arrow'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var arrowLength = arrowLengthAccessor(link);\n            var numSegments = state.linkDirectionalArrowResolution;\n\n            if (!obj.geometry.type.match(/^Cone(Buffer)?Geometry$/) || obj.geometry.parameters.height !== arrowLength || obj.geometry.parameters.radialSegments !== numSegments) {\n              var coneGeometry = new three$1.ConeBufferGeometry(arrowLength * 0.25, arrowLength, numSegments); // Correct orientation\n\n              coneGeometry.translate(0, arrowLength / 2, 0);\n              coneGeometry.rotateX(Math.PI / 2);\n              obj.geometry.dispose();\n              obj.geometry = coneGeometry;\n            }\n\n            obj.material.color = new three$1.Color(arrowColorAccessor(link) || _colorAccessor(link) || '#f0f0f0');\n            obj.material.opacity = state.linkOpacity * 3;\n          }\n        });\n      } // Photon particles digest cycle\n\n\n      if (state.linkDirectionalParticles || changedProps.hasOwnProperty('linkDirectionalParticles')) {\n        var particlesAccessor = accessorFn(state.linkDirectionalParticles);\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var particleMaterials = {}; // indexed by link color\n\n        var particleGeometries = {}; // indexed by particle width\n\n        threeDigest(visibleLinks.filter(particlesAccessor), state.graphScene, {\n          objBindAttr: '__photonsObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'photons';\n          },\n          createObj: function createObj() {\n            var obj = new three$1.Group();\n            obj.__linkThreeObjType = 'photons'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var numPhotons = Math.round(Math.abs(particlesAccessor(link)));\n            var curPhoton = !!obj.children.length && obj.children[0];\n            var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n            var numSegments = state.linkDirectionalParticleResolution;\n            var particleGeometry;\n\n            if (curPhoton && curPhoton.geometry.parameters.radius === photonR && curPhoton.geometry.parameters.widthSegments === numSegments) {\n              particleGeometry = curPhoton.geometry;\n            } else {\n              if (!particleGeometries.hasOwnProperty(photonR)) {\n                particleGeometries[photonR] = new three$1.SphereBufferGeometry(photonR, numSegments, numSegments);\n              }\n\n              particleGeometry = particleGeometries[photonR];\n              curPhoton && curPhoton.geometry.dispose();\n            }\n\n            var photonColor = particleColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n            var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n            var opacity = state.linkOpacity * 3;\n            var particleMaterial;\n\n            if (curPhoton && curPhoton.material.color.equals(materialColor) && curPhoton.material.opacity === opacity) {\n              particleMaterial = curPhoton.material;\n            } else {\n              if (!particleMaterials.hasOwnProperty(photonColor)) {\n                particleMaterials[photonColor] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n\n              particleMaterial = particleMaterials[photonColor];\n              curPhoton && curPhoton.material.dispose();\n            } // digest cycle for each photon\n\n\n            threeDigest(_toConsumableArray(new Array(numPhotons)).map(function (_, idx) {\n              return {\n                idx: idx\n              };\n            }), obj, {\n              idAccessor: function idAccessor(d) {\n                return d.idx;\n              },\n              createObj: function createObj() {\n                return new three$1.Mesh(particleGeometry, particleMaterial);\n              },\n              updateObj: function updateObj(obj) {\n                obj.geometry = particleGeometry;\n                obj.material = particleMaterial;\n              }\n            });\n          }\n        });\n      }\n    }\n\n    state._flushObjects = false; // reset objects refresh flag\n    // simulation engine\n\n    if (hasAnyPropChanged(['graphData', 'nodeId', 'linkSource', 'linkTarget', 'numDimensions', 'forceEngine', 'dagMode', 'dagNodeFilter', 'dagLevelDistance'])) {\n      state.engineRunning = false; // Pause simulation\n      // parse links\n\n      state.graphData.links.forEach(function (link) {\n        link.source = link[state.linkSource];\n        link.target = link[state.linkTarget];\n      }); // Feed data to force-directed layout\n\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      var layout;\n\n      if (isD3Sim) {\n        // D3-force\n        (layout = state.d3ForceLayout).stop().alpha(1) // re-heat the simulation\n        .numDimensions(state.numDimensions).nodes(state.graphData.nodes); // add links (if link force is still active)\n\n        var linkForce = state.d3ForceLayout.force('link');\n\n        if (linkForce) {\n          linkForce.id(function (d) {\n            return d[state.nodeId];\n          }).links(state.graphData.links);\n        } // setup dag force constraints\n\n\n        var nodeDepths = state.dagMode && getDagDepths(state.graphData, function (node) {\n          return node[state.nodeId];\n        }, {\n          nodeFilter: state.dagNodeFilter,\n          onLoopError: state.onDagError || undefined\n        });\n        var maxDepth = Math.max.apply(Math, _toConsumableArray(Object.values(nodeDepths || [])));\n        var dagLevelDistance = state.dagLevelDistance || state.graphData.nodes.length / (maxDepth || 1) * DAG_LEVEL_NODE_RATIO * (['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? 0.7 : 1); // Fix nodes to x,y,z for dag mode\n\n        if (state.dagMode) {\n          var getFFn = function getFFn(fix, invert) {\n            return function (node) {\n              return !fix ? undefined : (nodeDepths[node[state.nodeId]] - maxDepth / 2) * dagLevelDistance * (invert ? -1 : 1);\n            };\n          };\n\n          var fxFn = getFFn(['lr', 'rl'].indexOf(state.dagMode) !== -1, state.dagMode === 'rl');\n          var fyFn = getFFn(['td', 'bu'].indexOf(state.dagMode) !== -1, state.dagMode === 'td');\n          var fzFn = getFFn(['zin', 'zout'].indexOf(state.dagMode) !== -1, state.dagMode === 'zout');\n          state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n            node.fx = fxFn(node);\n            node.fy = fyFn(node);\n            node.fz = fzFn(node);\n          });\n        } // Use radial force for radial dags\n\n\n        state.d3ForceLayout.force('dagRadial', ['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? forceRadial(function (node) {\n          var nodeDepth = nodeDepths[node[state.nodeId]] || -1;\n          return (state.dagMode === 'radialin' ? maxDepth - nodeDepth : nodeDepth) * dagLevelDistance;\n        }).strength(function (node) {\n          return state.dagNodeFilter(node) ? 1 : 0;\n        }) : null);\n      } else {\n        // ngraph\n        var _graph = ngraph.graph();\n\n        state.graphData.nodes.forEach(function (node) {\n          _graph.addNode(node[state.nodeId]);\n        });\n        state.graphData.links.forEach(function (link) {\n          _graph.addLink(link.source, link.target);\n        });\n        layout = ngraph.forcelayout(_graph, _objectSpread2({\n          dimensions: state.numDimensions\n        }, state.ngraphPhysics));\n        layout.graph = _graph; // Attach graph reference to layout\n      }\n\n      for (var i = 0; i < state.warmupTicks && !(isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin); i++) {\n        layout[isD3Sim ? \"tick\" : \"step\"]();\n      } // Initial ticks before starting to render\n\n\n      state.layout = layout;\n      this.resetCountdown();\n    }\n\n    state.engineRunning = true; // resume simulation\n\n    state.onFinishUpdate();\n  }\n});\n\nfunction fromKapsule (kapsule) {\n  var baseClass = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Object;\n  var initKapsuleWithSelf = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var FromKapsule = /*#__PURE__*/function (_baseClass) {\n    _inherits(FromKapsule, _baseClass);\n\n    var _super = _createSuper(FromKapsule);\n\n    function FromKapsule() {\n      var _this;\n\n      _classCallCheck(this, FromKapsule);\n\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      _this = _super.call.apply(_super, [this].concat(args));\n      _this.__kapsuleInstance = kapsule().apply(void 0, [].concat(_toConsumableArray(initKapsuleWithSelf ? [_assertThisInitialized(_this)] : []), args));\n      return _this;\n    }\n\n    return _createClass(FromKapsule);\n  }(baseClass); // attach kapsule props/methods to class prototype\n\n\n  Object.keys(kapsule()).forEach(function (m) {\n    return FromKapsule.prototype[m] = function () {\n      var _this$__kapsuleInstan;\n\n      var returnVal = (_this$__kapsuleInstan = this.__kapsuleInstance)[m].apply(_this$__kapsuleInstan, arguments);\n\n      return returnVal === this.__kapsuleInstance ? this // chain based on this class, not the kapsule obj\n      : returnVal;\n    };\n  });\n  return FromKapsule;\n}\n\nvar three = window.THREE ? window.THREE : {\n  Group: Group\n}; // Prefer consumption from global THREE, if exists\nvar threeForcegraph = fromKapsule(ForceGraph, three.Group, true);\n\nexport { threeForcegraph as default };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}