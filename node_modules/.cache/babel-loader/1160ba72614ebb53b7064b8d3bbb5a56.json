{"ast":null,"code":"import { WebGLRenderer, Scene, PerspectiveCamera, Raycaster, TextureLoader, Vector2, Vector3, Box3, Color, Mesh, SphereGeometry, MeshBasicMaterial, BackSide, EventDispatcher, MOUSE, Quaternion, Spherical, Clock } from 'three';\nimport { TrackballControls } from 'three/examples/jsm/controls/TrackballControls.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { FlyControls } from 'three/examples/jsm/controls/FlyControls.js';\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer.js';\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass.js';\nimport { parseToRgb, opacify } from 'polished';\nimport TWEEN from '@tweenjs/tween.js';\nimport accessorFn from 'accessor-fn';\nimport Kapsule from 'kapsule';\n\nfunction styleInject(css, ref) {\n  if (ref === void 0) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') {\n    return;\n  }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css_248z = \".scene-nav-info {\\n  bottom: 5px;\\n  width: 100%;\\n  text-align: center;\\n  color: slategrey;\\n  opacity: 0.7;\\n  font-size: 10px;\\n}\\n\\n.scene-tooltip {\\n  top: 0;\\n  color: lavender;\\n  font-size: 15px;\\n}\\n\\n.scene-nav-info, .scene-tooltip {\\n  position: absolute;\\n  font-family: sans-serif;\\n  pointer-events: none;\\n}\\n\\n.scene-container canvas:focus {\\n  outline: none;\\n}\";\nstyleInject(css_248z);\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar three = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  WebGLRenderer: WebGLRenderer,\n  Scene: Scene,\n  PerspectiveCamera: PerspectiveCamera,\n  Raycaster: Raycaster,\n  TextureLoader: TextureLoader,\n  Vector2: Vector2,\n  Vector3: Vector3,\n  Box3: Box3,\n  Color: Color,\n  Mesh: Mesh,\n  SphereGeometry: SphereGeometry,\n  MeshBasicMaterial: MeshBasicMaterial,\n  BackSide: BackSide,\n  EventDispatcher: EventDispatcher,\n  MOUSE: MOUSE,\n  Quaternion: Quaternion,\n  Spherical: Spherical,\n  Clock: Clock\n};\nvar threeRenderObjects = Kapsule({\n  props: {\n    width: {\n      \"default\": window.innerWidth,\n      onChange: function onChange(width, state, prevWidth) {\n        isNaN(width) && (state.width = prevWidth);\n      }\n    },\n    height: {\n      \"default\": window.innerHeight,\n      onChange: function onChange(height, state, prevHeight) {\n        isNaN(height) && (state.height = prevHeight);\n      }\n    },\n    backgroundColor: {\n      \"default\": '#000011'\n    },\n    backgroundImageUrl: {},\n    onBackgroundImageLoaded: {},\n    showNavInfo: {\n      \"default\": true\n    },\n    skyRadius: {\n      \"default\": 50000\n    },\n    objects: {\n      \"default\": []\n    },\n    enablePointerInteraction: {\n      \"default\": true,\n      onChange: function onChange(_, state) {\n        // Reset hover state\n        state.hoverObj = null;\n        if (state.toolTipElem) state.toolTipElem.innerHTML = '';\n      },\n      triggerUpdate: false\n    },\n    lineHoverPrecision: {\n      \"default\": 1,\n      triggerUpdate: false\n    },\n    hoverOrderComparator: {\n      \"default\": function _default() {\n        return -1;\n      },\n      triggerUpdate: false\n    },\n    // keep existing order by default\n    hoverFilter: {\n      \"default\": function _default() {\n        return true;\n      },\n      triggerUpdate: false\n    },\n    // exclude objects from interaction\n    tooltipContent: {\n      triggerUpdate: false\n    },\n    hoverDuringDrag: {\n      \"default\": false,\n      triggerUpdate: false\n    },\n    clickAfterDrag: {\n      \"default\": false,\n      triggerUpdate: false\n    },\n    onHover: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onClick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onRightClick: {\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    tick: function tick(state) {\n      if (state.initialised) {\n        state.controls.update && state.controls.update(state.clock.getDelta()); // timedelta is required for fly controls\n\n        state.postProcessingComposer ? state.postProcessingComposer.render() // if using postprocessing, switch the output to it\n        : state.renderer.render(state.scene, state.camera);\n        state.extraRenderers.forEach(function (r) {\n          return r.render(state.scene, state.camera);\n        });\n\n        if (state.enablePointerInteraction) {\n          // Update tooltip and trigger onHover events\n          var topObject = null;\n\n          if (state.hoverDuringDrag || !state.isPointerDragging) {\n            var intersects = this.intersectingObjects(state.pointerPos.x, state.pointerPos.y).filter(function (d) {\n              return state.hoverFilter(d.object);\n            }).sort(function (a, b) {\n              return state.hoverOrderComparator(a.object, b.object);\n            });\n            var topIntersect = intersects.length ? intersects[0] : null;\n            topObject = topIntersect ? topIntersect.object : null;\n            state.intersectionPoint = topIntersect ? topIntersect.point : null;\n          }\n\n          if (topObject !== state.hoverObj) {\n            state.onHover(topObject, state.hoverObj);\n            state.toolTipElem.innerHTML = topObject ? accessorFn(state.tooltipContent)(topObject) || '' : '';\n            state.hoverObj = topObject;\n          }\n        }\n\n        TWEEN.update(); // update camera animation tweens\n      }\n\n      return this;\n    },\n    getPointerPos: function getPointerPos(state) {\n      var _state$pointerPos = state.pointerPos,\n          x = _state$pointerPos.x,\n          y = _state$pointerPos.y;\n      return {\n        x: x,\n        y: y\n      };\n    },\n    cameraPosition: function cameraPosition(state, position, lookAt, transitionDuration) {\n      var camera = state.camera; // Setter\n\n      if (position && state.initialised) {\n        var finalPos = position;\n        var finalLookAt = lookAt || {\n          x: 0,\n          y: 0,\n          z: 0\n        };\n\n        if (!transitionDuration) {\n          // no animation\n          setCameraPos(finalPos);\n          setLookAt(finalLookAt);\n        } else {\n          var camPos = Object.assign({}, camera.position);\n          var camLookAt = getLookAt();\n          new TWEEN.Tween(camPos).to(finalPos, transitionDuration).easing(TWEEN.Easing.Quadratic.Out).onUpdate(setCameraPos).start(); // Face direction in 1/3rd of time\n\n          new TWEEN.Tween(camLookAt).to(finalLookAt, transitionDuration / 3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(setLookAt).start();\n        }\n\n        return this;\n      } // Getter\n\n\n      return Object.assign({}, camera.position, {\n        lookAt: getLookAt()\n      }); //\n\n      function setCameraPos(pos) {\n        var x = pos.x,\n            y = pos.y,\n            z = pos.z;\n        if (x !== undefined) camera.position.x = x;\n        if (y !== undefined) camera.position.y = y;\n        if (z !== undefined) camera.position.z = z;\n      }\n\n      function setLookAt(lookAt) {\n        var lookAtVect = new three.Vector3(lookAt.x, lookAt.y, lookAt.z);\n\n        if (state.controls.target) {\n          state.controls.target = lookAtVect;\n        } else {\n          // Fly controls doesn't have target attribute\n          camera.lookAt(lookAtVect); // note: lookAt may be overridden by other controls in some cases\n        }\n      }\n\n      function getLookAt() {\n        return Object.assign(new three.Vector3(0, 0, -1000).applyQuaternion(camera.quaternion).add(camera.position));\n      }\n    },\n    zoomToFit: function zoomToFit(state) {\n      var transitionDuration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var padding = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 10;\n\n      for (var _len = arguments.length, bboxArgs = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n        bboxArgs[_key - 3] = arguments[_key];\n      }\n\n      return this.fitToBbox(this.getBbox.apply(this, bboxArgs), transitionDuration, padding);\n    },\n    fitToBbox: function fitToBbox(state, bbox) {\n      var transitionDuration = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var padding = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 10; // based on https://discourse.threejs.org/t/camera-zoom-to-fit-object/936/24\n\n      var camera = state.camera;\n\n      if (bbox) {\n        var center = new three.Vector3(0, 0, 0); // reset camera aim to center\n\n        var maxBoxSide = Math.max.apply(Math, _toConsumableArray(Object.entries(bbox).map(function (_ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n              coordType = _ref2[0],\n              coords = _ref2[1];\n\n          return Math.max.apply(Math, _toConsumableArray(coords.map(function (c) {\n            return Math.abs(center[coordType] - c);\n          })));\n        }))) * 2; // find distance that fits whole bbox within padded fov\n\n        var paddedFov = (1 - padding * 2 / state.height) * camera.fov;\n        var fitHeightDistance = maxBoxSide / Math.atan(paddedFov * Math.PI / 180);\n        var fitWidthDistance = fitHeightDistance / camera.aspect;\n        var distance = Math.max(fitHeightDistance, fitWidthDistance);\n\n        if (distance > 0) {\n          var newCameraPosition = center.clone().sub(camera.position).normalize().multiplyScalar(-distance);\n          this.cameraPosition(newCameraPosition, center, transitionDuration);\n        }\n      }\n\n      return this;\n    },\n    getBbox: function getBbox(state) {\n      var objFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      var box = new three.Box3(new three.Vector3(0, 0, 0), new three.Vector3(0, 0, 0));\n      var objs = state.objects.filter(objFilter);\n      if (!objs.length) return null;\n      objs.forEach(function (obj) {\n        return box.expandByObject(obj);\n      }); // extract global x,y,z min/max\n\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [box.min[c], box.max[c]]);\n      })));\n    },\n    getScreenCoords: function getScreenCoords(state, x, y, z) {\n      var vec = new three.Vector3(x, y, z);\n      vec.project(this.camera()); // project to the camera plane\n\n      return {\n        // align relative pos to canvas dimensions\n        x: (vec.x + 1) * state.width / 2,\n        y: -(vec.y - 1) * state.height / 2\n      };\n    },\n    getSceneCoords: function getSceneCoords(state, screenX, screenY) {\n      var distance = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      var relCoords = new three.Vector2(screenX / state.width * 2 - 1, -(screenY / state.height) * 2 + 1);\n      var raycaster = new three.Raycaster();\n      raycaster.setFromCamera(relCoords, state.camera);\n      return Object.assign({}, raycaster.ray.at(distance, new three.Vector3()));\n    },\n    intersectingObjects: function intersectingObjects(state, x, y) {\n      var relCoords = new three.Vector2(x / state.width * 2 - 1, -(y / state.height) * 2 + 1);\n      var raycaster = new three.Raycaster();\n      raycaster.params.Line.threshold = state.lineHoverPrecision; // set linePrecision\n\n      raycaster.setFromCamera(relCoords, state.camera);\n      return raycaster.intersectObjects(state.objects, true);\n    },\n    renderer: function renderer(state) {\n      return state.renderer;\n    },\n    scene: function scene(state) {\n      return state.scene;\n    },\n    camera: function camera(state) {\n      return state.camera;\n    },\n    postProcessingComposer: function postProcessingComposer(state) {\n      return state.postProcessingComposer;\n    },\n    controls: function controls(state) {\n      return state.controls;\n    },\n    tbControls: function tbControls(state) {\n      return state.controls;\n    } // to be deprecated\n\n  },\n  stateInit: function stateInit() {\n    return {\n      scene: new three.Scene(),\n      camera: new three.PerspectiveCamera(),\n      clock: new three.Clock()\n    };\n  },\n  init: function init(domNode, state) {\n    var _ref4 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n        _ref4$controlType = _ref4.controlType,\n        controlType = _ref4$controlType === void 0 ? 'trackball' : _ref4$controlType,\n        _ref4$rendererConfig = _ref4.rendererConfig,\n        rendererConfig = _ref4$rendererConfig === void 0 ? {} : _ref4$rendererConfig,\n        _ref4$extraRenderers = _ref4.extraRenderers,\n        extraRenderers = _ref4$extraRenderers === void 0 ? [] : _ref4$extraRenderers,\n        _ref4$waitForLoadComp = _ref4.waitForLoadComplete,\n        waitForLoadComplete = _ref4$waitForLoadComp === void 0 ? true : _ref4$waitForLoadComp; // Wipe DOM\n\n\n    domNode.innerHTML = ''; // Add relative container\n\n    domNode.appendChild(state.container = document.createElement('div'));\n    state.container.className = 'scene-container';\n    state.container.style.position = 'relative'; // Add nav info section\n\n    state.container.appendChild(state.navInfo = document.createElement('div'));\n    state.navInfo.className = 'scene-nav-info';\n    state.navInfo.textContent = {\n      orbit: 'Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan',\n      trackball: 'Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan',\n      fly: 'WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw'\n    }[controlType] || '';\n    state.navInfo.style.display = state.showNavInfo ? null : 'none'; // Setup tooltip\n\n    state.toolTipElem = document.createElement('div');\n    state.toolTipElem.classList.add('scene-tooltip');\n    state.container.appendChild(state.toolTipElem); // Capture pointer coords on move or touchstart\n\n    state.pointerPos = new three.Vector2();\n    state.pointerPos.x = -2; // Initialize off canvas\n\n    state.pointerPos.y = -2;\n    ['pointermove', 'pointerdown'].forEach(function (evType) {\n      return state.container.addEventListener(evType, function (ev) {\n        // track click state\n        evType === 'pointerdown' && (state.isPointerPressed = true); // detect point drag\n\n        !state.isPointerDragging && ev.type === 'pointermove' && (ev.pressure > 0 || state.isPointerPressed) // ev.pressure always 0 on Safari, so we used the isPointerPressed tracker\n        && (ev.pointerType !== 'touch' || ev.movementX === undefined || [ev.movementX, ev.movementY].some(function (m) {\n          return Math.abs(m) > 1;\n        })) // relax drag trigger sensitivity on touch events\n        && (state.isPointerDragging = true);\n\n        if (state.enablePointerInteraction) {\n          // update the pointer pos\n          var offset = getOffset(state.container);\n          state.pointerPos.x = ev.pageX - offset.left;\n          state.pointerPos.y = ev.pageY - offset.top; // Move tooltip\n\n          state.toolTipElem.style.top = \"\".concat(state.pointerPos.y, \"px\");\n          state.toolTipElem.style.left = \"\".concat(state.pointerPos.x, \"px\");\n          state.toolTipElem.style.transform = \"translate(-\".concat(state.pointerPos.x / state.width * 100, \"%, 21px)\"); // adjust horizontal position to not exceed canvas boundaries\n        }\n\n        function getOffset(el) {\n          var rect = el.getBoundingClientRect(),\n              scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,\n              scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n          return {\n            top: rect.top + scrollTop,\n            left: rect.left + scrollLeft\n          };\n        }\n      }, {\n        passive: true\n      });\n    }); // Handle click events on objs\n\n    state.container.addEventListener('pointerup', function (ev) {\n      state.isPointerPressed = false;\n\n      if (state.isPointerDragging) {\n        state.isPointerDragging = false;\n        if (!state.clickAfterDrag) return; // don't trigger onClick after pointer drag (camera motion via controls)\n      }\n\n      requestAnimationFrame(function () {\n        // trigger click events asynchronously, to allow hoverObj to be set (on frame)\n        if (ev.button === 0) {\n          // left-click\n          state.onClick(state.hoverObj || null, ev, state.intersectionPoint); // trigger background clicks with null\n        }\n\n        if (ev.button === 2 && state.onRightClick) {\n          // right-click\n          state.onRightClick(state.hoverObj || null, ev, state.intersectionPoint);\n        }\n      });\n    }, {\n      passive: true,\n      capture: true\n    }); // use capture phase to prevent propagation blocking from controls (specifically for fly)\n\n    state.container.addEventListener('contextmenu', function (ev) {\n      if (state.onRightClick) ev.preventDefault(); // prevent default contextmenu behavior and allow pointerup to fire instead\n    }); // Setup renderer, camera and controls\n\n    state.renderer = new three.WebGLRenderer(Object.assign({\n      antialias: true,\n      alpha: true\n    }, rendererConfig));\n    state.renderer.setPixelRatio(Math.min(2, window.devicePixelRatio)); // clamp device pixel ratio\n\n    state.container.appendChild(state.renderer.domElement); // Setup extra renderers\n\n    state.extraRenderers = extraRenderers;\n    state.extraRenderers.forEach(function (r) {\n      // overlay them on top of main renderer\n      r.domElement.style.position = 'absolute';\n      r.domElement.style.top = '0px';\n      r.domElement.style.pointerEvents = 'none';\n      state.container.appendChild(r.domElement);\n    }); // configure post-processing composer\n\n    state.postProcessingComposer = new EffectComposer(state.renderer);\n    state.postProcessingComposer.addPass(new RenderPass(state.scene, state.camera)); // render scene as first pass\n    // configure controls\n\n    state.controls = new {\n      trackball: TrackballControls,\n      orbit: OrbitControls,\n      fly: FlyControls\n    }[controlType](state.camera, state.renderer.domElement);\n\n    if (controlType === 'fly') {\n      state.controls.movementSpeed = 300;\n      state.controls.rollSpeed = Math.PI / 6;\n      state.controls.dragToLook = true;\n    }\n\n    if (controlType === 'trackball' || controlType === 'orbit') {\n      state.controls.minDistance = 0.1;\n      state.controls.maxDistance = state.skyRadius;\n      state.controls.addEventListener('start', function () {\n        state.controlsEngaged = true;\n      });\n      state.controls.addEventListener('change', function () {\n        if (state.controlsEngaged) {\n          state.controlsDragging = true;\n        }\n      });\n      state.controls.addEventListener('end', function () {\n        state.controlsEngaged = false;\n        state.controlsDragging = false;\n      });\n    }\n\n    [state.renderer, state.postProcessingComposer].concat(_toConsumableArray(state.extraRenderers)).forEach(function (r) {\n      return r.setSize(state.width, state.height);\n    });\n    state.camera.aspect = state.width / state.height;\n    state.camera.updateProjectionMatrix();\n    state.camera.position.z = 1000; // add sky\n\n    state.scene.add(state.skysphere = new three.Mesh());\n    state.skysphere.visible = false;\n    state.loadComplete = state.scene.visible = !waitForLoadComplete;\n    window.scene = state.scene;\n  },\n  update: function update(state, changedProps) {\n    // resize canvas\n    if (state.width && state.height && (changedProps.hasOwnProperty('width') || changedProps.hasOwnProperty('height'))) {\n      state.container.style.width = \"\".concat(state.width, \"px\");\n      state.container.style.height = \"\".concat(state.height, \"px\");\n      [state.renderer, state.postProcessingComposer].concat(_toConsumableArray(state.extraRenderers)).forEach(function (r) {\n        return r.setSize(state.width, state.height);\n      });\n      state.camera.aspect = state.width / state.height;\n      state.camera.updateProjectionMatrix();\n    }\n\n    if (changedProps.hasOwnProperty('skyRadius') && state.skyRadius) {\n      state.controls.hasOwnProperty('maxDistance') && changedProps.skyRadius && (state.controls.maxDistance = state.skyRadius);\n      state.camera.far = state.skyRadius * 2.5;\n      state.camera.updateProjectionMatrix();\n      state.skysphere.geometry = new three.SphereGeometry(state.skyRadius);\n    }\n\n    if (changedProps.hasOwnProperty('backgroundColor')) {\n      var alpha = parseToRgb(state.backgroundColor).alpha;\n      if (alpha === undefined) alpha = 1;\n      state.renderer.setClearColor(new three.Color(opacify(1, state.backgroundColor)), alpha);\n    }\n\n    if (changedProps.hasOwnProperty('backgroundImageUrl')) {\n      if (!state.backgroundImageUrl) {\n        state.skysphere.visible = false;\n        state.skysphere.material.map = null;\n        !state.loadComplete && finishLoad();\n      } else {\n        new three.TextureLoader().load(state.backgroundImageUrl, function (texture) {\n          state.skysphere.material = new three.MeshBasicMaterial({\n            map: texture,\n            side: three.BackSide\n          });\n          state.skysphere.visible = true; // triggered when background image finishes loading (asynchronously to allow 1 frame to load texture)\n\n          state.onBackgroundImageLoaded && setTimeout(state.onBackgroundImageLoaded);\n          !state.loadComplete && finishLoad();\n        });\n      }\n    }\n\n    changedProps.hasOwnProperty('showNavInfo') && (state.navInfo.style.display = state.showNavInfo ? null : 'none');\n\n    if (changedProps.hasOwnProperty('objects')) {\n      (changedProps.objects || []).forEach(function (obj) {\n        return state.scene.remove(obj);\n      }); // Clear the place\n\n      state.objects.forEach(function (obj) {\n        return state.scene.add(obj);\n      }); // Add to scene\n    } //\n\n\n    function finishLoad() {\n      state.loadComplete = state.scene.visible = true;\n    }\n  }\n});\nexport { threeRenderObjects as default };","map":{"version":3,"names":["WebGLRenderer","Scene","PerspectiveCamera","Raycaster","TextureLoader","Vector2","Vector3","Box3","Color","Mesh","SphereGeometry","MeshBasicMaterial","BackSide","EventDispatcher","MOUSE","Quaternion","Spherical","Clock","TrackballControls","OrbitControls","FlyControls","EffectComposer","RenderPass","parseToRgb","opacify","TWEEN","accessorFn","Kapsule","styleInject","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","css_248z","_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Array","isArray","_arrayLikeToArray","iter","Symbol","iterator","from","_i","_arr","_n","_d","_s","_e","call","next","done","push","length","err","o","minLen","n","prototype","toString","slice","constructor","name","test","len","arr2","TypeError","three","window","THREE","threeRenderObjects","props","width","innerWidth","onChange","state","prevWidth","isNaN","height","innerHeight","prevHeight","backgroundColor","backgroundImageUrl","onBackgroundImageLoaded","showNavInfo","skyRadius","objects","enablePointerInteraction","_","hoverObj","toolTipElem","innerHTML","triggerUpdate","lineHoverPrecision","hoverOrderComparator","_default","hoverFilter","tooltipContent","hoverDuringDrag","clickAfterDrag","onHover","onClick","onRightClick","methods","tick","initialised","controls","update","clock","getDelta","postProcessingComposer","render","renderer","scene","camera","extraRenderers","forEach","r","topObject","isPointerDragging","intersects","intersectingObjects","pointerPos","x","y","filter","d","object","sort","a","b","topIntersect","intersectionPoint","point","getPointerPos","_state$pointerPos","cameraPosition","position","lookAt","transitionDuration","finalPos","finalLookAt","z","setCameraPos","setLookAt","camPos","assign","camLookAt","getLookAt","Tween","to","easing","Easing","Quadratic","Out","onUpdate","start","pos","undefined","lookAtVect","target","applyQuaternion","quaternion","add","zoomToFit","arguments","padding","_len","bboxArgs","_key","fitToBbox","getBbox","apply","bbox","center","maxBoxSide","Math","max","entries","map","_ref","_ref2","coordType","coords","c","abs","paddedFov","fov","fitHeightDistance","atan","PI","fitWidthDistance","aspect","distance","newCameraPosition","clone","sub","normalize","multiplyScalar","objFilter","box","objs","expandByObject","min","getScreenCoords","vec","project","getSceneCoords","screenX","screenY","relCoords","raycaster","setFromCamera","ray","at","params","Line","threshold","intersectObjects","tbControls","stateInit","init","domNode","_ref4","_ref4$controlType","controlType","_ref4$rendererConfig","rendererConfig","_ref4$extraRenderers","_ref4$waitForLoadComp","waitForLoadComplete","container","className","navInfo","textContent","orbit","trackball","fly","display","classList","evType","addEventListener","ev","isPointerPressed","pressure","pointerType","movementX","movementY","some","m","offset","getOffset","pageX","left","pageY","top","concat","transform","el","rect","getBoundingClientRect","scrollLeft","pageXOffset","documentElement","scrollTop","pageYOffset","passive","requestAnimationFrame","button","capture","preventDefault","antialias","alpha","setPixelRatio","devicePixelRatio","domElement","pointerEvents","addPass","movementSpeed","rollSpeed","dragToLook","minDistance","maxDistance","controlsEngaged","controlsDragging","setSize","updateProjectionMatrix","skysphere","visible","loadComplete","changedProps","hasOwnProperty","far","geometry","setClearColor","material","finishLoad","load","texture","side","setTimeout","remove","default"],"sources":["X:/Project/back/node_modules/three-render-objects/dist/three-render-objects.module.js"],"sourcesContent":["import { WebGLRenderer, Scene, PerspectiveCamera, Raycaster, TextureLoader, Vector2, Vector3, Box3, Color, Mesh, SphereGeometry, MeshBasicMaterial, BackSide, EventDispatcher, MOUSE, Quaternion, Spherical, Clock } from 'three';\nimport { TrackballControls } from 'three/examples/jsm/controls/TrackballControls.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { FlyControls } from 'three/examples/jsm/controls/FlyControls.js';\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer.js';\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass.js';\nimport { parseToRgb, opacify } from 'polished';\nimport TWEEN from '@tweenjs/tween.js';\nimport accessorFn from 'accessor-fn';\nimport Kapsule from 'kapsule';\n\nfunction styleInject(css, ref) {\n  if (ref === void 0) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') {\n    return;\n  }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css_248z = \".scene-nav-info {\\n  bottom: 5px;\\n  width: 100%;\\n  text-align: center;\\n  color: slategrey;\\n  opacity: 0.7;\\n  font-size: 10px;\\n}\\n\\n.scene-tooltip {\\n  top: 0;\\n  color: lavender;\\n  font-size: 15px;\\n}\\n\\n.scene-nav-info, .scene-tooltip {\\n  position: absolute;\\n  font-family: sans-serif;\\n  pointer-events: none;\\n}\\n\\n.scene-container canvas:focus {\\n  outline: none;\\n}\";\nstyleInject(css_248z);\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar three = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  WebGLRenderer: WebGLRenderer,\n  Scene: Scene,\n  PerspectiveCamera: PerspectiveCamera,\n  Raycaster: Raycaster,\n  TextureLoader: TextureLoader,\n  Vector2: Vector2,\n  Vector3: Vector3,\n  Box3: Box3,\n  Color: Color,\n  Mesh: Mesh,\n  SphereGeometry: SphereGeometry,\n  MeshBasicMaterial: MeshBasicMaterial,\n  BackSide: BackSide,\n  EventDispatcher: EventDispatcher,\n  MOUSE: MOUSE,\n  Quaternion: Quaternion,\n  Spherical: Spherical,\n  Clock: Clock\n};\nvar threeRenderObjects = Kapsule({\n  props: {\n    width: {\n      \"default\": window.innerWidth,\n      onChange: function onChange(width, state, prevWidth) {\n        isNaN(width) && (state.width = prevWidth);\n      }\n    },\n    height: {\n      \"default\": window.innerHeight,\n      onChange: function onChange(height, state, prevHeight) {\n        isNaN(height) && (state.height = prevHeight);\n      }\n    },\n    backgroundColor: {\n      \"default\": '#000011'\n    },\n    backgroundImageUrl: {},\n    onBackgroundImageLoaded: {},\n    showNavInfo: {\n      \"default\": true\n    },\n    skyRadius: {\n      \"default\": 50000\n    },\n    objects: {\n      \"default\": []\n    },\n    enablePointerInteraction: {\n      \"default\": true,\n      onChange: function onChange(_, state) {\n        // Reset hover state\n        state.hoverObj = null;\n        if (state.toolTipElem) state.toolTipElem.innerHTML = '';\n      },\n      triggerUpdate: false\n    },\n    lineHoverPrecision: {\n      \"default\": 1,\n      triggerUpdate: false\n    },\n    hoverOrderComparator: {\n      \"default\": function _default() {\n        return -1;\n      },\n      triggerUpdate: false\n    },\n    // keep existing order by default\n    hoverFilter: {\n      \"default\": function _default() {\n        return true;\n      },\n      triggerUpdate: false\n    },\n    // exclude objects from interaction\n    tooltipContent: {\n      triggerUpdate: false\n    },\n    hoverDuringDrag: {\n      \"default\": false,\n      triggerUpdate: false\n    },\n    clickAfterDrag: {\n      \"default\": false,\n      triggerUpdate: false\n    },\n    onHover: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onClick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onRightClick: {\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    tick: function tick(state) {\n      if (state.initialised) {\n        state.controls.update && state.controls.update(state.clock.getDelta()); // timedelta is required for fly controls\n\n        state.postProcessingComposer ? state.postProcessingComposer.render() // if using postprocessing, switch the output to it\n        : state.renderer.render(state.scene, state.camera);\n        state.extraRenderers.forEach(function (r) {\n          return r.render(state.scene, state.camera);\n        });\n\n        if (state.enablePointerInteraction) {\n          // Update tooltip and trigger onHover events\n          var topObject = null;\n\n          if (state.hoverDuringDrag || !state.isPointerDragging) {\n            var intersects = this.intersectingObjects(state.pointerPos.x, state.pointerPos.y).filter(function (d) {\n              return state.hoverFilter(d.object);\n            }).sort(function (a, b) {\n              return state.hoverOrderComparator(a.object, b.object);\n            });\n            var topIntersect = intersects.length ? intersects[0] : null;\n            topObject = topIntersect ? topIntersect.object : null;\n            state.intersectionPoint = topIntersect ? topIntersect.point : null;\n          }\n\n          if (topObject !== state.hoverObj) {\n            state.onHover(topObject, state.hoverObj);\n            state.toolTipElem.innerHTML = topObject ? accessorFn(state.tooltipContent)(topObject) || '' : '';\n            state.hoverObj = topObject;\n          }\n        }\n\n        TWEEN.update(); // update camera animation tweens\n      }\n\n      return this;\n    },\n    getPointerPos: function getPointerPos(state) {\n      var _state$pointerPos = state.pointerPos,\n          x = _state$pointerPos.x,\n          y = _state$pointerPos.y;\n      return {\n        x: x,\n        y: y\n      };\n    },\n    cameraPosition: function cameraPosition(state, position, lookAt, transitionDuration) {\n      var camera = state.camera; // Setter\n\n      if (position && state.initialised) {\n        var finalPos = position;\n        var finalLookAt = lookAt || {\n          x: 0,\n          y: 0,\n          z: 0\n        };\n\n        if (!transitionDuration) {\n          // no animation\n          setCameraPos(finalPos);\n          setLookAt(finalLookAt);\n        } else {\n          var camPos = Object.assign({}, camera.position);\n          var camLookAt = getLookAt();\n          new TWEEN.Tween(camPos).to(finalPos, transitionDuration).easing(TWEEN.Easing.Quadratic.Out).onUpdate(setCameraPos).start(); // Face direction in 1/3rd of time\n\n          new TWEEN.Tween(camLookAt).to(finalLookAt, transitionDuration / 3).easing(TWEEN.Easing.Quadratic.Out).onUpdate(setLookAt).start();\n        }\n\n        return this;\n      } // Getter\n\n\n      return Object.assign({}, camera.position, {\n        lookAt: getLookAt()\n      }); //\n\n      function setCameraPos(pos) {\n        var x = pos.x,\n            y = pos.y,\n            z = pos.z;\n        if (x !== undefined) camera.position.x = x;\n        if (y !== undefined) camera.position.y = y;\n        if (z !== undefined) camera.position.z = z;\n      }\n\n      function setLookAt(lookAt) {\n        var lookAtVect = new three.Vector3(lookAt.x, lookAt.y, lookAt.z);\n\n        if (state.controls.target) {\n          state.controls.target = lookAtVect;\n        } else {\n          // Fly controls doesn't have target attribute\n          camera.lookAt(lookAtVect); // note: lookAt may be overridden by other controls in some cases\n        }\n      }\n\n      function getLookAt() {\n        return Object.assign(new three.Vector3(0, 0, -1000).applyQuaternion(camera.quaternion).add(camera.position));\n      }\n    },\n    zoomToFit: function zoomToFit(state) {\n      var transitionDuration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var padding = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 10;\n\n      for (var _len = arguments.length, bboxArgs = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n        bboxArgs[_key - 3] = arguments[_key];\n      }\n\n      return this.fitToBbox(this.getBbox.apply(this, bboxArgs), transitionDuration, padding);\n    },\n    fitToBbox: function fitToBbox(state, bbox) {\n      var transitionDuration = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var padding = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 10;\n      // based on https://discourse.threejs.org/t/camera-zoom-to-fit-object/936/24\n      var camera = state.camera;\n\n      if (bbox) {\n        var center = new three.Vector3(0, 0, 0); // reset camera aim to center\n\n        var maxBoxSide = Math.max.apply(Math, _toConsumableArray(Object.entries(bbox).map(function (_ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n              coordType = _ref2[0],\n              coords = _ref2[1];\n\n          return Math.max.apply(Math, _toConsumableArray(coords.map(function (c) {\n            return Math.abs(center[coordType] - c);\n          })));\n        }))) * 2; // find distance that fits whole bbox within padded fov\n\n        var paddedFov = (1 - padding * 2 / state.height) * camera.fov;\n        var fitHeightDistance = maxBoxSide / Math.atan(paddedFov * Math.PI / 180);\n        var fitWidthDistance = fitHeightDistance / camera.aspect;\n        var distance = Math.max(fitHeightDistance, fitWidthDistance);\n\n        if (distance > 0) {\n          var newCameraPosition = center.clone().sub(camera.position).normalize().multiplyScalar(-distance);\n          this.cameraPosition(newCameraPosition, center, transitionDuration);\n        }\n      }\n\n      return this;\n    },\n    getBbox: function getBbox(state) {\n      var objFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      var box = new three.Box3(new three.Vector3(0, 0, 0), new three.Vector3(0, 0, 0));\n      var objs = state.objects.filter(objFilter);\n      if (!objs.length) return null;\n      objs.forEach(function (obj) {\n        return box.expandByObject(obj);\n      }); // extract global x,y,z min/max\n\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [box.min[c], box.max[c]]);\n      })));\n    },\n    getScreenCoords: function getScreenCoords(state, x, y, z) {\n      var vec = new three.Vector3(x, y, z);\n      vec.project(this.camera()); // project to the camera plane\n\n      return {\n        // align relative pos to canvas dimensions\n        x: (vec.x + 1) * state.width / 2,\n        y: -(vec.y - 1) * state.height / 2\n      };\n    },\n    getSceneCoords: function getSceneCoords(state, screenX, screenY) {\n      var distance = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      var relCoords = new three.Vector2(screenX / state.width * 2 - 1, -(screenY / state.height) * 2 + 1);\n      var raycaster = new three.Raycaster();\n      raycaster.setFromCamera(relCoords, state.camera);\n      return Object.assign({}, raycaster.ray.at(distance, new three.Vector3()));\n    },\n    intersectingObjects: function intersectingObjects(state, x, y) {\n      var relCoords = new three.Vector2(x / state.width * 2 - 1, -(y / state.height) * 2 + 1);\n      var raycaster = new three.Raycaster();\n      raycaster.params.Line.threshold = state.lineHoverPrecision; // set linePrecision\n\n      raycaster.setFromCamera(relCoords, state.camera);\n      return raycaster.intersectObjects(state.objects, true);\n    },\n    renderer: function renderer(state) {\n      return state.renderer;\n    },\n    scene: function scene(state) {\n      return state.scene;\n    },\n    camera: function camera(state) {\n      return state.camera;\n    },\n    postProcessingComposer: function postProcessingComposer(state) {\n      return state.postProcessingComposer;\n    },\n    controls: function controls(state) {\n      return state.controls;\n    },\n    tbControls: function tbControls(state) {\n      return state.controls;\n    } // to be deprecated\n\n  },\n  stateInit: function stateInit() {\n    return {\n      scene: new three.Scene(),\n      camera: new three.PerspectiveCamera(),\n      clock: new three.Clock()\n    };\n  },\n  init: function init(domNode, state) {\n    var _ref4 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n        _ref4$controlType = _ref4.controlType,\n        controlType = _ref4$controlType === void 0 ? 'trackball' : _ref4$controlType,\n        _ref4$rendererConfig = _ref4.rendererConfig,\n        rendererConfig = _ref4$rendererConfig === void 0 ? {} : _ref4$rendererConfig,\n        _ref4$extraRenderers = _ref4.extraRenderers,\n        extraRenderers = _ref4$extraRenderers === void 0 ? [] : _ref4$extraRenderers,\n        _ref4$waitForLoadComp = _ref4.waitForLoadComplete,\n        waitForLoadComplete = _ref4$waitForLoadComp === void 0 ? true : _ref4$waitForLoadComp;\n\n    // Wipe DOM\n    domNode.innerHTML = ''; // Add relative container\n\n    domNode.appendChild(state.container = document.createElement('div'));\n    state.container.className = 'scene-container';\n    state.container.style.position = 'relative'; // Add nav info section\n\n    state.container.appendChild(state.navInfo = document.createElement('div'));\n    state.navInfo.className = 'scene-nav-info';\n    state.navInfo.textContent = {\n      orbit: 'Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan',\n      trackball: 'Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan',\n      fly: 'WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw'\n    }[controlType] || '';\n    state.navInfo.style.display = state.showNavInfo ? null : 'none'; // Setup tooltip\n\n    state.toolTipElem = document.createElement('div');\n    state.toolTipElem.classList.add('scene-tooltip');\n    state.container.appendChild(state.toolTipElem); // Capture pointer coords on move or touchstart\n\n    state.pointerPos = new three.Vector2();\n    state.pointerPos.x = -2; // Initialize off canvas\n\n    state.pointerPos.y = -2;\n    ['pointermove', 'pointerdown'].forEach(function (evType) {\n      return state.container.addEventListener(evType, function (ev) {\n        // track click state\n        evType === 'pointerdown' && (state.isPointerPressed = true); // detect point drag\n\n        !state.isPointerDragging && ev.type === 'pointermove' && (ev.pressure > 0 || state.isPointerPressed) // ev.pressure always 0 on Safari, so we used the isPointerPressed tracker\n        && (ev.pointerType !== 'touch' || ev.movementX === undefined || [ev.movementX, ev.movementY].some(function (m) {\n          return Math.abs(m) > 1;\n        })) // relax drag trigger sensitivity on touch events\n        && (state.isPointerDragging = true);\n\n        if (state.enablePointerInteraction) {\n          // update the pointer pos\n          var offset = getOffset(state.container);\n          state.pointerPos.x = ev.pageX - offset.left;\n          state.pointerPos.y = ev.pageY - offset.top; // Move tooltip\n\n          state.toolTipElem.style.top = \"\".concat(state.pointerPos.y, \"px\");\n          state.toolTipElem.style.left = \"\".concat(state.pointerPos.x, \"px\");\n          state.toolTipElem.style.transform = \"translate(-\".concat(state.pointerPos.x / state.width * 100, \"%, 21px)\"); // adjust horizontal position to not exceed canvas boundaries\n        }\n\n        function getOffset(el) {\n          var rect = el.getBoundingClientRect(),\n              scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,\n              scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n          return {\n            top: rect.top + scrollTop,\n            left: rect.left + scrollLeft\n          };\n        }\n      }, {\n        passive: true\n      });\n    }); // Handle click events on objs\n\n    state.container.addEventListener('pointerup', function (ev) {\n      state.isPointerPressed = false;\n\n      if (state.isPointerDragging) {\n        state.isPointerDragging = false;\n        if (!state.clickAfterDrag) return; // don't trigger onClick after pointer drag (camera motion via controls)\n      }\n\n      requestAnimationFrame(function () {\n        // trigger click events asynchronously, to allow hoverObj to be set (on frame)\n        if (ev.button === 0) {\n          // left-click\n          state.onClick(state.hoverObj || null, ev, state.intersectionPoint); // trigger background clicks with null\n        }\n\n        if (ev.button === 2 && state.onRightClick) {\n          // right-click\n          state.onRightClick(state.hoverObj || null, ev, state.intersectionPoint);\n        }\n      });\n    }, {\n      passive: true,\n      capture: true\n    }); // use capture phase to prevent propagation blocking from controls (specifically for fly)\n\n    state.container.addEventListener('contextmenu', function (ev) {\n      if (state.onRightClick) ev.preventDefault(); // prevent default contextmenu behavior and allow pointerup to fire instead\n    }); // Setup renderer, camera and controls\n\n    state.renderer = new three.WebGLRenderer(Object.assign({\n      antialias: true,\n      alpha: true\n    }, rendererConfig));\n    state.renderer.setPixelRatio(Math.min(2, window.devicePixelRatio)); // clamp device pixel ratio\n\n    state.container.appendChild(state.renderer.domElement); // Setup extra renderers\n\n    state.extraRenderers = extraRenderers;\n    state.extraRenderers.forEach(function (r) {\n      // overlay them on top of main renderer\n      r.domElement.style.position = 'absolute';\n      r.domElement.style.top = '0px';\n      r.domElement.style.pointerEvents = 'none';\n      state.container.appendChild(r.domElement);\n    }); // configure post-processing composer\n\n    state.postProcessingComposer = new EffectComposer(state.renderer);\n    state.postProcessingComposer.addPass(new RenderPass(state.scene, state.camera)); // render scene as first pass\n    // configure controls\n\n    state.controls = new {\n      trackball: TrackballControls,\n      orbit: OrbitControls,\n      fly: FlyControls\n    }[controlType](state.camera, state.renderer.domElement);\n\n    if (controlType === 'fly') {\n      state.controls.movementSpeed = 300;\n      state.controls.rollSpeed = Math.PI / 6;\n      state.controls.dragToLook = true;\n    }\n\n    if (controlType === 'trackball' || controlType === 'orbit') {\n      state.controls.minDistance = 0.1;\n      state.controls.maxDistance = state.skyRadius;\n      state.controls.addEventListener('start', function () {\n        state.controlsEngaged = true;\n      });\n      state.controls.addEventListener('change', function () {\n        if (state.controlsEngaged) {\n          state.controlsDragging = true;\n        }\n      });\n      state.controls.addEventListener('end', function () {\n        state.controlsEngaged = false;\n        state.controlsDragging = false;\n      });\n    }\n\n    [state.renderer, state.postProcessingComposer].concat(_toConsumableArray(state.extraRenderers)).forEach(function (r) {\n      return r.setSize(state.width, state.height);\n    });\n    state.camera.aspect = state.width / state.height;\n    state.camera.updateProjectionMatrix();\n    state.camera.position.z = 1000; // add sky\n\n    state.scene.add(state.skysphere = new three.Mesh());\n    state.skysphere.visible = false;\n    state.loadComplete = state.scene.visible = !waitForLoadComplete;\n    window.scene = state.scene;\n  },\n  update: function update(state, changedProps) {\n    // resize canvas\n    if (state.width && state.height && (changedProps.hasOwnProperty('width') || changedProps.hasOwnProperty('height'))) {\n      state.container.style.width = \"\".concat(state.width, \"px\");\n      state.container.style.height = \"\".concat(state.height, \"px\");\n      [state.renderer, state.postProcessingComposer].concat(_toConsumableArray(state.extraRenderers)).forEach(function (r) {\n        return r.setSize(state.width, state.height);\n      });\n      state.camera.aspect = state.width / state.height;\n      state.camera.updateProjectionMatrix();\n    }\n\n    if (changedProps.hasOwnProperty('skyRadius') && state.skyRadius) {\n      state.controls.hasOwnProperty('maxDistance') && changedProps.skyRadius && (state.controls.maxDistance = state.skyRadius);\n      state.camera.far = state.skyRadius * 2.5;\n      state.camera.updateProjectionMatrix();\n      state.skysphere.geometry = new three.SphereGeometry(state.skyRadius);\n    }\n\n    if (changedProps.hasOwnProperty('backgroundColor')) {\n      var alpha = parseToRgb(state.backgroundColor).alpha;\n      if (alpha === undefined) alpha = 1;\n      state.renderer.setClearColor(new three.Color(opacify(1, state.backgroundColor)), alpha);\n    }\n\n    if (changedProps.hasOwnProperty('backgroundImageUrl')) {\n      if (!state.backgroundImageUrl) {\n        state.skysphere.visible = false;\n        state.skysphere.material.map = null;\n        !state.loadComplete && finishLoad();\n      } else {\n        new three.TextureLoader().load(state.backgroundImageUrl, function (texture) {\n          state.skysphere.material = new three.MeshBasicMaterial({\n            map: texture,\n            side: three.BackSide\n          });\n          state.skysphere.visible = true; // triggered when background image finishes loading (asynchronously to allow 1 frame to load texture)\n\n          state.onBackgroundImageLoaded && setTimeout(state.onBackgroundImageLoaded);\n          !state.loadComplete && finishLoad();\n        });\n      }\n    }\n\n    changedProps.hasOwnProperty('showNavInfo') && (state.navInfo.style.display = state.showNavInfo ? null : 'none');\n\n    if (changedProps.hasOwnProperty('objects')) {\n      (changedProps.objects || []).forEach(function (obj) {\n        return state.scene.remove(obj);\n      }); // Clear the place\n\n      state.objects.forEach(function (obj) {\n        return state.scene.add(obj);\n      }); // Add to scene\n    } //\n\n\n    function finishLoad() {\n      state.loadComplete = state.scene.visible = true;\n    }\n  }\n});\n\nexport { threeRenderObjects as default };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}